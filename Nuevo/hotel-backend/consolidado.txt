ğŸ“‚ Estructura del proyecto (.):
-----------------------------------
.
â”œâ”€â”€ consolidado.txt
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ main
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ java
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ com
â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ hotel
â”‚Â Â  â”‚Â Â  â”‚Â Â          â””â”€â”€ hotel_backend
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ Controller
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ ReservaController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ dao
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDAOEnMemoria.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDAOEnMemoria.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDAOEnMemoria.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDAOEnMemoria.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDAOEnMemoria.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ ReservaDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ domain
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Direccion.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Estadia.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Factura.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Habitacion.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Huesped.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Cheque.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Efectivo.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePago.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjera.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ Tarjeta.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCredito.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Pago.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Reserva.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePago.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuesped.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridico.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ Titular.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ dto
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ConsumoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ DireccionDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ChequeDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ EfectivoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePagoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjeraDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ TarjetaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCreditoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ PagoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePagoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuespedDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridicoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ TitularDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ HotelBackendApplication.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â””â”€â”€ service
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ EstadiaService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ FacturaService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ HabitacionService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ HuespedService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ Mapeo
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”‚Â Â  â”œâ”€â”€ MapearADominio.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”‚Â Â  â””â”€â”€ MapearADTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â””â”€â”€ ReservaService.java
â”‚Â Â  â”‚Â Â  â””â”€â”€ resources
â”‚Â Â  â”‚Â Â      â””â”€â”€ application.properties
â”‚Â Â  â””â”€â”€ test
â”‚Â Â      â””â”€â”€ java
â”‚Â Â          â””â”€â”€ com
â”‚Â Â              â””â”€â”€ hotel
â”‚Â Â                  â””â”€â”€ hotel_backend
â”‚Â Â                      â””â”€â”€ HotelBackendApplicationTests.java
â””â”€â”€ target
    â”œâ”€â”€ classes
    â”‚Â Â  â”œâ”€â”€ application.properties
    â”‚Â Â  â””â”€â”€ com
    â”‚Â Â      â””â”€â”€ hotel
    â”‚Â Â          â””â”€â”€ hotel_backend
    â”‚Â Â              â”œâ”€â”€ Controller
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaController.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaController.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedController.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ ReservaController.class
    â”‚Â Â              â”œâ”€â”€ dao
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDAOEnMemoria.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDAOEnMemoria.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDAOEnMemoria.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDAOEnMemoria.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDAO.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ ReservaDAOEnMemoria.class
    â”‚Â Â              â”œâ”€â”€ domain
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Direccion.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Estadia.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Factura.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Habitacion.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Huesped.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Cheque.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Efectivo.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePago.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjera.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ Tarjeta.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCredito.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Pago.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Reserva.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePago.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuesped.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridico.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ Titular.class
    â”‚Â Â              â”œâ”€â”€ dto
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ConsumoDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ DireccionDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ChequeDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ EfectivoDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePagoDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjeraDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ TarjetaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCreditoDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ PagoDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePagoDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuespedDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridicoDTO.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ TitularDTO.class
    â”‚Â Â              â”œâ”€â”€ HotelBackendApplication.class
    â”‚Â Â              â””â”€â”€ service
    â”‚Â Â                  â”œâ”€â”€ EstadiaService.class
    â”‚Â Â                  â”œâ”€â”€ FacturaService.class
    â”‚Â Â                  â”œâ”€â”€ HabitacionService.class
    â”‚Â Â                  â”œâ”€â”€ HuespedService.class
    â”‚Â Â                  â”œâ”€â”€ Mapeo
    â”‚Â Â                  â”‚Â Â  â”œâ”€â”€ MapearADominio.class
    â”‚Â Â                  â”‚Â Â  â””â”€â”€ MapearADTO.class
    â”‚Â Â                  â””â”€â”€ ReservaService.class
    â”œâ”€â”€ generated-sources
    â”‚Â Â  â””â”€â”€ annotations
    â”œâ”€â”€ generated-test-sources
    â”‚Â Â  â””â”€â”€ test-annotations
    â”œâ”€â”€ maven-status
    â”‚Â Â  â””â”€â”€ maven-compiler-plugin
    â”‚Â Â      â”œâ”€â”€ compile
    â”‚Â Â      â”‚Â Â  â””â”€â”€ default-compile
    â”‚Â Â      â”‚Â Â      â”œâ”€â”€ createdFiles.lst
    â”‚Â Â      â”‚Â Â      â””â”€â”€ inputFiles.lst
    â”‚Â Â      â””â”€â”€ testCompile
    â”‚Â Â          â””â”€â”€ default-testCompile
    â”‚Â Â              â”œâ”€â”€ createdFiles.lst
    â”‚Â Â              â””â”€â”€ inputFiles.lst
    â””â”€â”€ test-classes
        â””â”€â”€ com
            â””â”€â”€ hotel
                â””â”€â”€ hotel_backend
                    â””â”€â”€ HotelBackendApplicationTests.class

52 directories, 126 files

-----------------------------------

// [src/main/java/com/hotel/hotel_backend/Controller/EstadiaController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dao.EstadiaDAOEnMemoria;
import com.hotel.hotel_backend.dao.ReservaDAOEnMemoria;
import com.hotel.hotel_backend.dao.HabitacionDAOEnMemoria;
import com.hotel.hotel_backend.dto.EstadiaDTO;
import com.hotel.hotel_backend.service.EstadiaService;
import com.hotel.hotel_backend.service.HabitacionService;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/estadias")
public class EstadiaController {

    private final EstadiaService estadiaService;

    public EstadiaController() {

        HabitacionService habitacionService =
                new HabitacionService(HabitacionDAOEnMemoria.getInstance());

        this.estadiaService = new EstadiaService(
                EstadiaDAOEnMemoria.getInstance(),
                ReservaDAOEnMemoria.getInstance(),
                habitacionService
        );
    }

    // ============================================================
    //                GENERAR ESTADÃA (CHECK-IN)
    // ============================================================
    @PostMapping
    public ResponseEntity<?> generar(@RequestBody EstadiaDTO dto) {
        try {
            String respuesta = estadiaService.generarEstadia(dto);
            return ResponseEntity.ok(respuesta);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================================
    //      OBTENER ESTADÃA ACTIVA POR NÃšMERO DE HABITACIÃ“N
    // ============================================================
    @GetMapping("/activa/{numeroHabitacion}")
    public ResponseEntity<?> obtenerActiva(@PathVariable int numeroHabitacion) {
        try {
            EstadiaDTO respuesta = estadiaService.obtenerEstadiaActivaPorHabitacion(numeroHabitacion);
            return ResponseEntity.ok(respuesta);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/Controller/FacturaController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dao.FacturaDAOEnMemoria;
import com.hotel.hotel_backend.dto.FacturaDTO;
import com.hotel.hotel_backend.dto.NotaDeCreditoDTO;
import com.hotel.hotel_backend.service.FacturaService;

import java.time.LocalDate;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/facturas")
public class FacturaController {

    private final FacturaService facturaService;

    public FacturaController() {
        this.facturaService = new FacturaService(FacturaDAOEnMemoria.getInstance());
    }

    @PostMapping
    public ResponseEntity<?> generar(@RequestBody FacturaDTO dto) {
        try {
            String msg = facturaService.generarFactura(dto);
            return ResponseEntity.ok(msg);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    @GetMapping("/{id}")
    public ResponseEntity<?> obtener(@PathVariable int id) {
        try {
            return ResponseEntity.ok(facturaService.obtenerFacturaPorId(id));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    @GetMapping
    public ResponseEntity<?> listar() {
        return ResponseEntity.ok(facturaService.listarTodas());
    }

    @GetMapping("/pendientes/{numeroHabitacion}")
    public ResponseEntity<?> listarPendientesPorHabitacion(@PathVariable int numeroHabitacion) {
        try {
            return ResponseEntity.ok(facturaService.obtenerPendientesPorHabitacion(numeroHabitacion));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
    @PutMapping
    public ResponseEntity<?> actualizar(@RequestBody FacturaDTO dto) {
        try {
            Object resultado = facturaService.actualizarFactura(dto);
            return ResponseEntity.ok(resultado);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }


    @PostMapping("/notaDeCredito")
    public ResponseEntity<?> crearNota(@RequestBody NotaDeCreditoDTO dto) {
        try {
            return ResponseEntity.ok(facturaService.crearNotaDeCredito(dto));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    
    @GetMapping("/pagos")
    public ResponseEntity<?> buscarPagosEntreFechas(
            @RequestParam String desde,
            @RequestParam String hasta
    ) {
        try {
            LocalDate fDesde = LocalDate.parse(desde);
            LocalDate fHasta = LocalDate.parse(hasta);

            return ResponseEntity.ok(
                    facturaService.buscarPagoesEntreFechas(fDesde, fHasta)
            );

        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    @GetMapping("/cheques")
    public ResponseEntity<?> buscarChequesEntreFechas(
            @RequestParam String desde,
            @RequestParam String hasta
    ) {
        try {
            LocalDate fDesde = LocalDate.parse(desde);
            LocalDate fHasta = LocalDate.parse(hasta);

            return ResponseEntity.ok(
                    facturaService.buscarChequesEntreFechas(fDesde, fHasta)
            );

        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

}



// [src/main/java/com/hotel/hotel_backend/Controller/HuespedController.java]
package com.hotel.hotel_backend.Controller;


import java.util.List;
import com.hotel.hotel_backend.dao.HuespedDAOEnMemoria;
import com.hotel.hotel_backend.domain.Huesped;
import com.hotel.hotel_backend.service.HuespedService;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;


@RestController
@RequestMapping("/api/huespedes")
public class HuespedController {

    private final HuespedService service;

    public HuespedController() {
        // TEMPORAL: MÃ¡s adelante esto se reemplaza con @Service + @Repository + @Autowired
        this.service = new HuespedService(HuespedDAOEnMemoria.getInstance());
    }

    // CU: Dar alta huÃ©sped
    @PostMapping
    public String crear(@RequestBody Huesped h) {
        service.darAlta(h);
        return "Huesped creado correctamente";
    }

    // Listar todos (para probar)
    @GetMapping
    public List<Huesped> listar() {
        return service.listar();
    }

    @GetMapping("/buscar")
    public List<Huesped> buscar(
            @RequestParam(required = false) String apellido,
            @RequestParam(required = false) String nombre,
            @RequestParam(required = false) String tipoDocumento,
            @RequestParam(required = false) String numeroDocumento
    ) {
        return service.buscarConFiltros(apellido, nombre, tipoDocumento, numeroDocumento);
    }

    @PutMapping("/modificar")
    public ResponseEntity<Huesped> modificar(@RequestBody Huesped cambios) {
        Huesped modificado = service.modificarHuesped(cambios);
        return ResponseEntity.ok(modificado);
    }




}



// [src/main/java/com/hotel/hotel_backend/Controller/ReservaController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dao.HabitacionDAOEnMemoria;
import com.hotel.hotel_backend.dao.ReservaDAOEnMemoria;
import com.hotel.hotel_backend.dto.ReservaDTO;
import com.hotel.hotel_backend.service.HabitacionService;
import com.hotel.hotel_backend.service.ReservaService;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/reservas")
public class ReservaController {

    private final ReservaService reservaService;

    public ReservaController() {

        HabitacionService habitacionService =
            new HabitacionService(HabitacionDAOEnMemoria.getInstance());

        this.reservaService =
            new ReservaService(ReservaDAOEnMemoria.getInstance(), habitacionService);
    }

    @PostMapping
    public ResponseEntity<?> crear(@RequestBody ReservaDTO dto) {

        try {
            ReservaDTO respuesta = reservaService.reservarHabitacion(dto);
            return ResponseEntity.ok(respuesta);

        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    @GetMapping("/entre")
    public ResponseEntity<?> listarEntre(@RequestParam String inicio,@RequestParam String fin) {
        try {
            List<ReservaDTO> lista = reservaService.listarReservasEntre(inicio, fin);
            return ResponseEntity.ok(lista);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    @PutMapping("/cancelar")
    public ResponseEntity<?> cancelar(@RequestBody ReservaDTO dto) {
        try {
            ReservaDTO respuesta = reservaService.cancelarReserva(dto);
            return ResponseEntity.ok(respuesta);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }


}



// [src/main/java/com/hotel/hotel_backend/dao/EstadiaDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Estadia;
import java.util.List;
import java.util.Optional;

public interface EstadiaDAO {

    void save(Estadia e);

    Optional<Estadia> findById(int id);

    List<Estadia> findAll();

    void update(Estadia e);

    Optional<Estadia> findActivaByHabitacion(int numeroHabitacion);

}



// [src/main/java/com/hotel/hotel_backend/dao/EstadiaDAOEnMemoria.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Estadia;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

public class EstadiaDAOEnMemoria implements EstadiaDAO {

    private static EstadiaDAOEnMemoria instance;
    private final List<Estadia> estadias = new ArrayList<>();
    private int secuenciaId = 1;

    private EstadiaDAOEnMemoria() {
        // Constructor privado para prevenir instanciaciÃ³n directa
    }

    public static synchronized EstadiaDAOEnMemoria getInstance() {
        if (instance == null) {
            instance = new EstadiaDAOEnMemoria();
        }
        return instance;
    }

    @Override
    public void save(Estadia e) {
        e.setId(secuenciaId++);
        estadias.add(e);
    }

    @Override
    public Optional<Estadia> findById(int id) {
        return estadias.stream()
                .filter(e -> e.getId() == id)
                .findFirst();
    }

    @Override
    public List<Estadia> findAll() {
        return new ArrayList<>(estadias);
    }

    @Override
    public void update(Estadia e) {
        for (int i = 0; i < estadias.size(); i++) {
            if (estadias.get(i).getId() == e.getId()) {
                estadias.set(i, e);
                return;
            }
        }
    }

    @Override
    public Optional<Estadia> findActivaByHabitacion(int numeroHabitacion) {
        ReservaDAO reservaDAO = ReservaDAOEnMemoria.getInstance();
        return estadias.stream()
                // estado activo = EnCurso
                .filter(e -> e.getEstado().equalsIgnoreCase("EnCurso"))
                // y que la reserva contenga esa habitaciÃ³n
                .filter(e -> {
                    var resOpt = reservaDAO.findById(e.getIdReserva());
                    if (resOpt.isEmpty()) return false;
                    var reserva = resOpt.get();
                    return reserva.getHabitaciones().contains(numeroHabitacion);
                })
                .findFirst();
    }


}



// [src/main/java/com/hotel/hotel_backend/dao/FacturaDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Factura;
import com.hotel.hotel_backend.domain.NotaDeCredito;
import com.hotel.hotel_backend.domain.Pago;

import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

public interface FacturaDAO {

    void save(Factura f);

    Optional<Factura> findById(int id);

    List<Factura> findAll();

    void update(Factura f);

    List<Factura> findPendientesByHabitacion(int nroHabitacion);

    List<Pago> findPagosEntreFechas(LocalDate desde, LocalDate hasta);
    
    List<Pago> findChequesEntreFechas(LocalDate desde, LocalDate hasta);

    void saveNota(NotaDeCredito nota);
}



// [src/main/java/com/hotel/hotel_backend/dao/FacturaDAOEnMemoria.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Factura;
import com.hotel.hotel_backend.domain.NotaDeCredito;
import com.hotel.hotel_backend.domain.Pago;
import com.hotel.hotel_backend.domain.Estadia;
import com.hotel.hotel_backend.domain.Reserva;
import com.hotel.hotel_backend.domain.MedioDePago.Cheque;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

public class FacturaDAOEnMemoria implements FacturaDAO {

    private static FacturaDAOEnMemoria instance;
    public static synchronized FacturaDAOEnMemoria getInstance() {
        if (instance == null) instance = new FacturaDAOEnMemoria();
        return instance;
    }

    private final List<Factura> facturas = new ArrayList<>();
    private final List<NotaDeCredito> notas = new ArrayList<>();
    private int secuenciaNota = 1;

    private int secuenciaId = 1;

    private FacturaDAOEnMemoria() {}

    @Override
    public void save(Factura f) {
        f.setId(secuenciaId++);
        facturas.add(f);
    }

    @Override
    public Optional<Factura> findById(int id) {
        return facturas.stream()
                .filter(x -> x.getId() == id)
                .findFirst();
    }

    @Override
    public List<Factura> findAll() {
        return new ArrayList<>(facturas);
    }

    @Override
    public void update(Factura f) {
        for (int i = 0; i < facturas.size(); i++) {
            if (facturas.get(i).getId() == f.getId()) {
                facturas.set(i, f);
                return;
            }
        }
    }

    @Override
    public List<Factura> findPendientesByHabitacion(int nroHabitacion) {

        return facturas.stream()
                .filter(f -> f.getEstado().equalsIgnoreCase("Pendiente"))
                .filter(f -> estadiaTieneHabitacion(f.getEstadia().getId(), nroHabitacion))
                .collect(Collectors.toList());
    }


    private boolean estadiaTieneHabitacion(int idEstadia, int nroHabitacion) {

        Estadia e = EstadiaDAOEnMemoria.getInstance()
                .findById(idEstadia)
                .orElse(null);

        if (e == null) return false;

        Reserva r = ReservaDAOEnMemoria.getInstance()
                .findById(e.getIdReserva())
                .orElse(null);

        if (r == null) return false;

        return r.getHabitaciones().contains(nroHabitacion);
    }

    public List<Pago> findChequesEntreFechas(LocalDate desde, LocalDate hasta) {

        List<Pago> resultado = new ArrayList<>();

        for (Factura f : facturas) {
            for (Pago p : f.getPagos()) {

                if (p.getMedioDePago() instanceof Cheque) {
                    LocalDate fechaPago = LocalDate.parse(p.getFecha());

                    if ((fechaPago.isEqual(desde) || fechaPago.isAfter(desde)) &&
                        (fechaPago.isEqual(hasta) || fechaPago.isBefore(hasta))) {

                        resultado.add(p);
                    }
                }
            }
        }

        return resultado;
    }

    public List<Pago> findPagosEntreFechas(LocalDate desde, LocalDate hasta) {

        List<Pago> resultado = new ArrayList<>();

        for (Factura f : facturas) {
            for (Pago p : f.getPagos()) {

                LocalDate fechaPago = LocalDate.parse(p.getFecha());

                if ((fechaPago.isEqual(desde) || fechaPago.isAfter(desde)) &&
                    (fechaPago.isEqual(hasta) || fechaPago.isBefore(hasta))) {

                    resultado.add(p);
                }
            }
        }

        return resultado;
    }

    public void saveNota(NotaDeCredito nota) {

       // generar ID
        nota.setIdNota(secuenciaNota++);

        // cancelar facturas asociadas
        if (nota.getFacturas() != null) {
            for (Factura fac : nota.getFacturas()) {

                // buscar factura original en memoria
                findById(fac.getId()).ifPresent(f -> {
                    f.setEstado("CANCELADA");   // <---- IMPORTANTE
                    update(f);                 // reemplazar factura vieja
                });
            }
        }

        // guardar nota en la lista
        notas.add(nota);
    }

}



// [src/main/java/com/hotel/hotel_backend/dao/HabitacionDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Habitacion;
import java.util.List;
import java.util.Optional;

public interface HabitacionDAO {

    void save(Habitacion h);

    Optional<Habitacion> findByNumero(int numero);

    List<Habitacion> findAll();

    void update(Habitacion h);
}



// [src/main/java/com/hotel/hotel_backend/dao/HabitacionDAOEnMemoria.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Habitacion;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

public class HabitacionDAOEnMemoria implements HabitacionDAO {

    private static HabitacionDAOEnMemoria instance;
    private final List<Habitacion> habitaciones = new ArrayList<>();

    private HabitacionDAOEnMemoria() {
        // Precargar habitaciones segÃºn el enunciado
        habitaciones.add(new Habitacion(101, "Individual", "Estandar", 50800, "Disponible"));
        habitaciones.add(new Habitacion(102, "Individual", "Estandar", 50800, "Disponible"));
        habitaciones.add(new Habitacion(201, "Doble", "Estandar", 70230, "Disponible"));
        habitaciones.add(new Habitacion(202, "Doble", "Estandar", 70230, "Disponible"));
        // ...podÃ©s agregar el resto mÃ¡s adelante
    }

    public static synchronized HabitacionDAOEnMemoria getInstance() {
        if (instance == null) {
            instance = new HabitacionDAOEnMemoria();
        }
        return instance;
    }

    @Override
    public void save(Habitacion h) {
        habitaciones.add(h);
    }

    @Override
    public Optional<Habitacion> findByNumero(int numero) {
        return habitaciones.stream()
                .filter(h -> h.getNumero() == numero)
                .findFirst();
    }

    @Override
    public List<Habitacion> findAll() {
        return new ArrayList<>(habitaciones);
    }

    @Override
    public void update(Habitacion h) {
        for (int i = 0; i < habitaciones.size(); i++) {
            if (habitaciones.get(i).getNumero() == h.getNumero()) {
                habitaciones.set(i, h);
                return;
            }
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/dao/HuespedDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Huesped;

import java.util.List;
import java.util.Optional;

public interface HuespedDAO {

    void save(Huesped h);

    Optional<Huesped> findByNumeroDocumento(String nroDoc);

    Optional<Huesped> findByCuit(String cuit);

    List<Huesped> findAll();
 
    void update(Huesped h);
}



// [src/main/java/com/hotel/hotel_backend/dao/HuespedDAOEnMemoria.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Huesped;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

public class HuespedDAOEnMemoria implements HuespedDAO {

    private static HuespedDAOEnMemoria instance;
    private final List<Huesped> huespedes = new ArrayList<>();

    private HuespedDAOEnMemoria() {
        // Constructor privado para prevenir instanciaciÃ³n directa
    }

    public static synchronized HuespedDAOEnMemoria getInstance() {
        if (instance == null) {
            instance = new HuespedDAOEnMemoria();
        }
        return instance;
    }

    @Override
    public void save(Huesped h) {
        huespedes.add(h);
    }

    @Override
    public Optional<Huesped> findByNumeroDocumento(String nroDoc) {
        return huespedes.stream()
                .filter(h -> h.getNumeroDocumento().equalsIgnoreCase(nroDoc))
                .findFirst();
    }

    @Override
    public List<Huesped> findAll() {
        return new ArrayList<>(huespedes);
    }

    @Override
    public Optional<Huesped> findByCuit(String cuit) {
        if (cuit == null || cuit.isEmpty()) return Optional.empty();
        return huespedes.stream()
                .filter(h -> cuit.equalsIgnoreCase(h.getCuit()))
                .findFirst();
    }

    @Override
    public void update(Huesped h) {
        for (int i = 0; i < huespedes.size(); i++) {
            if (huespedes.get(i).getNumeroDocumento().equals(h.getNumeroDocumento())) {
                huespedes.set(i, h);
                return;
            }
        }
    }

    

}



// [src/main/java/com/hotel/hotel_backend/dao/ReservaDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Reserva;

import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

public interface ReservaDAO {

    void save(Reserva r);

    Optional<Reserva> findById(int id);

    List<Reserva> findAll();

    void update(Reserva r);

    void delete(int id);
    
    List<Reserva> findBetween(LocalDate inicio, LocalDate fin);

}



// [src/main/java/com/hotel/hotel_backend/dao/ReservaDAOEnMemoria.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Reserva;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

public class ReservaDAOEnMemoria implements ReservaDAO {

    private static ReservaDAOEnMemoria instance;
    private final List<Reserva> reservas = new ArrayList<>();
    private int generadorId = 1;

    private ReservaDAOEnMemoria() {
        // Constructor privado para prevenir instanciaciÃ³n directa
    }

    public static synchronized ReservaDAOEnMemoria getInstance() {
        if (instance == null) {
            instance = new ReservaDAOEnMemoria();
        }
        return instance;
    }

    @Override
    public void save(Reserva r) {
        r.setId(generadorId++);
        reservas.add(r);
    }

    @Override
    public Optional<Reserva> findById(int id) {
        return reservas.stream()
                .filter(r -> r.getId() == id)
                .findFirst();
    }

    @Override
    public List<Reserva> findAll() {
        return new ArrayList<>(reservas);
    }

    @Override
    public void update(Reserva r) {
        for (int i = 0; i < reservas.size(); i++) {
            if (reservas.get(i).getId() == r.getId()) {
                reservas.set(i, r);
                return;
            }
        }
    }

    @Override
    public void delete(int id) {
        reservas.removeIf(r -> r.getId() == id);
    }

    @Override
    public List<Reserva> findBetween(LocalDate inicio, LocalDate fin) {

        return reservas.stream()
                .filter(r -> {
                    LocalDate ri = r.getFechaInicio();
                    LocalDate rf = r.getFechaFin();

                    // Se solapan:
                    return !(fin.isBefore(ri) || inicio.isAfter(rf));
                })
                .toList();
    }

}



// [src/main/java/com/hotel/hotel_backend/domain/Direccion.java]
package com.hotel.hotel_backend.domain;
import com.hotel.hotel_backend.dto.DireccionDTO;

public class Direccion {
    private String calle;
    private String numero;
    private String departamento;
    private String piso;
    private String codigoPostal;
    private String localidad;
    private String provincia;
    private String pais;

    public Direccion() {}

    public Direccion(String calle, String numero, String departamento, String piso,
                     String codigoPostal, String localidad, String provincia, String pais) {
        this.calle = calle;
        this.numero = numero;
        this.departamento = departamento;
        this.piso = piso;
        this.codigoPostal = codigoPostal;
        this.localidad = localidad;
        this.provincia = provincia;
        this.pais = pais;
    }

    // Getters y setters
    public String getCalle() { return calle; }
    public void setCalle(String calle) { this.calle = calle; }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getDepartamento() { return departamento; }
    public void setDepartamento(String departamento) { this.departamento = departamento; }

    public String getPiso() { return piso; }
    public void setPiso(String piso) { this.piso = piso; }

    public String getCodigoPostal() { return codigoPostal; }
    public void setCodigoPostal(String codigoPostal) { this.codigoPostal = codigoPostal; }

    public String getLocalidad() { return localidad; }
    public void setLocalidad(String localidad) { this.localidad = localidad; }

    public String getProvincia() { return provincia; }
    public void setProvincia(String provincia) { this.provincia = provincia; }

    public String getPais() { return pais; }
    public void setPais(String pais) { this.pais = pais; }

    public static DireccionDTO mapearDireccionADTO(Direccion direccion) {
        return new DireccionDTO(direccion.getCalle(), direccion.getNumero(), 
                                direccion.getDepartamento(), direccion.getPiso(), 
                                direccion.getCodigoPostal(), direccion.getLocalidad(), 
                                direccion.getProvincia(), direccion.getPais());
    }

    public static Direccion mapearDireccionDominio(DireccionDTO dto) {
        if (dto == null) return null;
        return new Direccion(
            dto.getCalle(),
            dto.getNumero(),
            dto.getDepartamento(),
            dto.getPiso(),
            dto.getCodigoPostal(),
            dto.getLocalidad(),
            dto.getProvincia(),
            dto.getPais()
        );
    }
}


// [src/main/java/com/hotel/hotel_backend/domain/Estadia.java]
package com.hotel.hotel_backend.domain;

import java.time.LocalDate;
import java.util.List;

public class Estadia {

    private int id;
    private LocalDate fechaCheckIn;
    private LocalDate fechaCheckOut;
    private String estado; // EnCurso / Finalizada

    private int idReserva; // vÃ­nculo con Reserva

    private Huesped titular;
    private List<Huesped> acompaniantes;

    public Estadia() {}

    public Estadia(
            int id,
            LocalDate fechaCheckIn,
            LocalDate fechaCheckOut,
            String estado,
            int idReserva,
            Huesped titular,
            List<Huesped> acompaniantes
    ) {
        this.id = id;
        this.fechaCheckIn = fechaCheckIn;
        this.fechaCheckOut = fechaCheckOut;
        this.estado = estado;
        this.idReserva = idReserva;
        this.titular = titular;
        this.acompaniantes = acompaniantes;
    }

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public LocalDate getFechaCheckIn() { return fechaCheckIn; }
    public void setFechaCheckIn(LocalDate fechaCheckIn) { this.fechaCheckIn = fechaCheckIn; }

    public LocalDate getFechaCheckOut() { return fechaCheckOut; }
    public void setFechaCheckOut(LocalDate fechaCheckOut) { this.fechaCheckOut = fechaCheckOut; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public int getIdReserva() { return idReserva; }
    public void setIdReserva(int idReserva) { this.idReserva = idReserva; }

    public Huesped getTitular() { return titular; }
    public void setTitular(Huesped titular) { this.titular = titular; }

    public List<Huesped> getAcompaniantes() { return acompaniantes; }
    public void setAcompaniantes(List<Huesped> acompaniantes) { this.acompaniantes = acompaniantes; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Factura.java]
package com.hotel.hotel_backend.domain;

import java.util.List;
import com.hotel.hotel_backend.domain.ResponsableDePago.*;
import com.hotel.hotel_backend.domain.MedioDePago.MedioDePago;
public class Factura {

    private int id;
    private String hora;
    private String fecha;
    private String tipo;
    private String estado;

    private ResponsableDePago responsableDePago; // â† puede ser Huesped o JurÃ­dica
    private MedioDePago medioDePago;             // â† Tarjeta/Efectivo/Cheque/Extranjera/null

    private Estadia estadia;

    private List<Pago> pagos;                   // â† lista vacÃ­a al crear
    private double total;
    private double iva;
    private String detalle;
    private String horaSalida;

    public Factura() {}

    public Factura(int id, String hora, String fecha, String tipo, String estado,
                      ResponsableDePago responsableDePago, MedioDePago medioDePago,
                      Estadia estadia, List<Pago> pagos,
                      double total, double iva, String detalle, String horaSalida) {

        this.id = id;
        this.hora = hora;
        this.fecha = fecha;
        this.tipo = tipo;
        this.estado = estado;
        this.responsableDePago = responsableDePago;
        this.medioDePago = medioDePago;
        this.estadia = estadia;
        this.pagos = pagos;
        this.total = total;
        this.iva = iva;
        this.detalle = detalle;
        this.horaSalida = horaSalida;
    }

    // ---------------- Getters & Setters ------------------

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public String getHora() { return hora; }
    public void setHora(String hora) { this.hora = hora; }

    public String getFecha() { return fecha; }
    public void setFecha(String fecha) { this.fecha = fecha; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public ResponsableDePago getResponsableDePago() { return responsableDePago; }
    public void setResponsableDePago(ResponsableDePago responsableDePago) { this.responsableDePago = responsableDePago; }

    public MedioDePago getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePago medioDePago) { this.medioDePago = medioDePago; }

    public Estadia getEstadia() { return estadia; }
    public void setEstadia(Estadia estadia) { this.estadia = estadia; }

    public List<Pago> getPagos() { return pagos; }
    public void setPagos(List<Pago> pagos) { this.pagos = pagos; }

    public double getTotal() { return total; }
    public void setTotal(double total) { this.total = total; }

    public double getIva() { return iva; }
    public void setIva(double iva) { this.iva = iva; }

    public String getDetalle() { return detalle; }
    public void setDetalle(String detalle) { this.detalle = detalle; }

    public String getHoraSalida() { return horaSalida; }
    public void setHoraSalida(String horaSalida) { this.horaSalida = horaSalida; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Habitacion.java]
package com.hotel.hotel_backend.domain;

public class Habitacion {

    private int numero;
    private String tipo;      // INDIVIDUAL, DOBLE, SUPERIOR, etc.
    private String categoria; // Estandar, Superior, Family, Suite
    private double costoPorNoche;

    private String estado; 
    // Disponible - Reservada - Ocupada - FueraDeServicio

    public Habitacion() {}

    public Habitacion(int numero, String tipo, String categoria, double costoPorNoche, String estado) {
        this.numero = numero;
        this.tipo = tipo;
        this.categoria = categoria;
        this.costoPorNoche = costoPorNoche;
        this.estado = estado;
    }

    public int getNumero() { return numero; }
    public void setNumero(int numero) { this.numero = numero; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getCategoria() { return categoria; }
    public void setCategoria(String categoria) { this.categoria = categoria; }

    public double getCostoPorNoche() { return costoPorNoche; }
    public void setCostoPorNoche(double costoPorNoche) { this.costoPorNoche = costoPorNoche; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Huesped.java]
package com.hotel.hotel_backend.domain;


public class Huesped {

    private String apellido;
    private String nombre;
    private String tipoDocumento;
    private String numeroDocumento;
    private String cuit;
    private String posicionIVA;
    private Direccion direccion;  // ComposiciÃ³n
    private String email;
    private String ocupacion;
    private String nacionalidad;
    private String direccionCompleta;
    public Huesped() {
    }

    public Huesped(String apellido, String nombre, String tipoDocumento, String numeroDocumento,
                   String cuit, String posicionIVA, Direccion direccion,
                   String email, String ocupacion, String nacionalidad) {
        this.apellido = apellido;
        this.nombre = nombre;
        this.tipoDocumento = tipoDocumento;
        this.numeroDocumento = numeroDocumento;
        this.cuit = cuit;
        this.posicionIVA = posicionIVA;
        this.direccion = direccion;
        this.email = email;
        this.ocupacion = ocupacion;
        this.nacionalidad = nacionalidad;
        this.direccionCompleta = direccion != null
                ? direccion.getCalle() + " " + direccion.getNumero() + ", " +
                  direccion.getLocalidad() + ", " + direccion.getProvincia()
                : "";
    }

    // ======== Getters y Setters ========

    public String getApellido() {
        return apellido;
    }

    public void setApellido(String apellido) {
        this.apellido = apellido;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    public String getTipoDocumento() {
        return tipoDocumento;
    }

    public void setTipoDocumento(String tipoDocumento) {
        this.tipoDocumento = tipoDocumento;
    }

    public String getNumeroDocumento() {
        return numeroDocumento;
    }

    public void setNumeroDocumento(String numeroDocumento) {
        this.numeroDocumento = numeroDocumento;
    }

    public String getCuit() {
        return cuit;
    }

    public void setCuit(String cuit) {
        this.cuit = cuit;
    }

    public String getPosicionIVA() {
        return posicionIVA;
    }

    public void setPosicionIVA(String posicionIVA) {
        this.posicionIVA = posicionIVA;
    }

    public Direccion getDireccion() {
        return direccion;
    }

    public void setDireccion(Direccion direccion) {
        this.direccion = direccion;
    }


    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getOcupacion() {
        return ocupacion;
    }

    public void setOcupacion(String ocupacion) {
        this.ocupacion = ocupacion;
    }

    public String getNacionalidad() {
        return nacionalidad;
    }

    public void setNacionalidad(String nacionalidad) {
        this.nacionalidad = nacionalidad;
    }
    public String getDireccionCompleta() {
        return direccionCompleta;
    }
    public void setDireccionCompleta(Direccion direccion) {
        this.direccionCompleta = direccion != null
                ? direccion.getCalle() + " " + direccion.getNumero() + ", " +
                  direccion.getLocalidad() + ", " + direccion.getProvincia()
                : "";
    }

}


// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/Cheque.java]
package com.hotel.hotel_backend.domain.MedioDePago;

public class Cheque extends MedioDePago {

    private String numero;
    private String fechaVencimiento;

    public Cheque() {}

    public Cheque(String numero, double monto, String fechaVencimiento) {
        super(monto);
        this.numero = numero;
        this.fechaVencimiento = fechaVencimiento;
    }

    @Override
    public String getTipo() {
        return "Cheque";
    }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getFechaVencimiento() { return fechaVencimiento; }
    public void setFechaVencimiento(String fechaVencimiento) { this.fechaVencimiento = fechaVencimiento; }
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/Efectivo.java]
package com.hotel.hotel_backend.domain.MedioDePago;

public class Efectivo extends MedioDePago {

    public Efectivo() {}

    public Efectivo(double monto) {
        super(monto);
    }

    @Override
    public String getTipo() {
        return "efectivo";
    }
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/MedioDePago.java]
package com.hotel.hotel_backend.domain.MedioDePago;

public abstract class MedioDePago {

    private double monto;

    public MedioDePago() {}

    public MedioDePago(double monto) {
        this.monto = monto;
    }

    public double getMonto() { return monto; }
    public void setMonto(double monto) { this.monto = monto; }

    public abstract String getTipo();
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/MonedaExtranjera.java]
package com.hotel.hotel_backend.domain.MedioDePago;

public class MonedaExtranjera extends MedioDePago {

    private String tipoMoneda;
    private double montoExtranjero;
    private double cotizacion;

    public MonedaExtranjera() {}

    public MonedaExtranjera(String tipoMoneda, double montoExtranjero,
                            double cotizacion, double monto) {
        super(monto);
        this.tipoMoneda = tipoMoneda;
        this.montoExtranjero = montoExtranjero;
        this.cotizacion = cotizacion;
    }

    @Override
    public String getTipo() {
        return "MonedaExtranjera";
    }

    public String getTipoMoneda() { return tipoMoneda; }
    public void setTipoMoneda(String tipoMoneda) { this.tipoMoneda = tipoMoneda; }

    public double getMontoExtranjero() { return montoExtranjero; }
    public void setMontoExtranjero(double montoExtranjero) { this.montoExtranjero = montoExtranjero; }

    public double getCotizacion() { return cotizacion; }
    public void setCotizacion(double cotizacion) { this.cotizacion = cotizacion; }
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/Tarjeta.java]
package com.hotel.hotel_backend.domain.MedioDePago;

public class Tarjeta extends MedioDePago {

    private String tipoTarjeta;     
    private String numeroTarjeta;

    public Tarjeta() {}

    public Tarjeta(String tipoTarjeta, String numeroTarjeta, double monto) {
        super(monto);
        this.tipoTarjeta = tipoTarjeta;
        this.numeroTarjeta = numeroTarjeta;
    }

    @Override
    public String getTipo() {
        return "Tarjeta";
    }

    public String getTipoTarjeta() { return tipoTarjeta; }
    public void setTipoTarjeta(String tipoTarjeta) { this.tipoTarjeta = tipoTarjeta; }

    public String getNumeroTarjeta() { return numeroTarjeta; }
    public void setNumeroTarjeta(String numeroTarjeta) { this.numeroTarjeta = numeroTarjeta; }
}



// [src/main/java/com/hotel/hotel_backend/domain/NotaDeCredito.java]
package com.hotel.hotel_backend.domain;

import com.hotel.hotel_backend.domain.ResponsableDePago.ResponsableDePago;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

public class NotaDeCredito {

    private Integer idNota;
    private LocalDate fecha;
    private ResponsableDePago responsable;
    private List<Factura> facturas;
    private String tipo;



    public NotaDeCredito(Integer idNota, LocalDate fecha, 
                         ResponsableDePago responsable, 
                         List<Factura> facturas,
                         String tipo) {
            this.idNota = idNota;
            this.fecha = fecha != null ? fecha : LocalDate.now();
            this.responsable = responsable;
            this.facturas = facturas != null ? facturas : new ArrayList<>();
            this.tipo = tipo;
    }

    public Integer getIdNota() { return idNota; }
    public void setIdNota(Integer idNota) { this.idNota = idNota; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public ResponsableDePago getResponsable() { return responsable; }
    public void setResponsable(ResponsableDePago responsable) { this.responsable = responsable; }

    public List<Factura> getFacturas() { return facturas; }
    public void setFacturas(List<Factura> facturas) { this.facturas = facturas; }


    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

}



// [src/main/java/com/hotel/hotel_backend/domain/Pago.java]
package com.hotel.hotel_backend.domain;
import com.hotel.hotel_backend.domain.MedioDePago.MedioDePago;

public class Pago {

    private int id;
    private String fecha;
    private String hora;
    private double montoTotal;
    private MedioDePago medioDePago;

    public Pago() {}

    public Pago(int id, String fecha, String hora, double montoTotal, MedioDePago medioDePago) {
        this.id = id;
        this.fecha = fecha;
        this.hora = hora;
        this.montoTotal = montoTotal;
        this.medioDePago = medioDePago;
    }

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public String getFecha() { return fecha; }
    public void setFecha(String fecha) { this.fecha = fecha; }

    public String getHora() { return hora; }
    public void setHora(String hora) { this.hora = hora; }

    public double getMontoTotal() { return montoTotal; }
    public void setMontoTotal(double montoTotal) { this.montoTotal = montoTotal; }

    public MedioDePago getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePago medioDePago) { this.medioDePago = medioDePago; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Reserva.java]
package com.hotel.hotel_backend.domain;

import java.time.LocalDate;
import java.util.List;

public class Reserva {

    private int id;
    private LocalDate fechaInicio;
    private LocalDate fechaFin;

    private Titular titular;  // Titular genÃ©rico (NO debe ser huÃ©sped obligatorio)
    private List<Integer> habitaciones; // nÃºmeros de habitaciÃ³n

    private String estado; // Pendiente - Confirmada - Cancelada

    public Reserva() {}

    public Reserva(int id, LocalDate fechaInicio, LocalDate fechaFin,
                   Titular titular, List<Integer> habitaciones, String estado) {

        this.id = id;
        this.fechaInicio = fechaInicio;
        this.fechaFin = fechaFin;
        this.titular = titular;
        this.habitaciones = habitaciones;
        this.estado = estado;
    }

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public LocalDate getFechaInicio() { return fechaInicio; }
    public void setFechaInicio(LocalDate fechaInicio) { this.fechaInicio = fechaInicio; }

    public LocalDate getFechaFin() { return fechaFin; }
    public void setFechaFin(LocalDate fechaFin) { this.fechaFin = fechaFin; }

    public Titular getTitular() { return titular; }
    public void setTitular(Titular titular) { this.titular = titular; }

    public List<Integer> getHabitaciones() { return habitaciones; }
    public void setHabitaciones(List<Integer> habitaciones) { this.habitaciones = habitaciones; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }
}



// [src/main/java/com/hotel/hotel_backend/domain/ResponsableDePago/ResponsableDePago.java]
package com.hotel.hotel_backend.domain.ResponsableDePago;

import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;

@JsonTypeInfo(
        use = JsonTypeInfo.Id.NAME,
        include = JsonTypeInfo.As.PROPERTY,
        property = "tipo"
)
@JsonSubTypes({
        @JsonSubTypes.Type(value = ResponsableHuesped.class, name = "huesped"),
        @JsonSubTypes.Type(value = ResponsableJuridico.class, name = "juridica")
})

public abstract class ResponsableDePago {
    private String tipo; // "huesped" o "juridica"

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }
}



// [src/main/java/com/hotel/hotel_backend/domain/ResponsableDePago/ResponsableHuesped.java]
package com.hotel.hotel_backend.domain.ResponsableDePago;

public class ResponsableHuesped extends ResponsableDePago {

    private String apellido;
    private String nombres;
    private String documento;

    public ResponsableHuesped() {
        setTipo("huesped");
    }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getNombres() { return nombres; }
    public void setNombres(String nombres) { this.nombres = nombres; }

    public String getDocumento() { return documento; }
    public void setDocumento(String documento) { this.documento = documento; }

}



// [src/main/java/com/hotel/hotel_backend/domain/ResponsableDePago/ResponsableJuridico.java]
package com.hotel.hotel_backend.domain.ResponsableDePago;

public class ResponsableJuridico extends ResponsableDePago {

    private String razonSocial;
    private String cuit;

    public ResponsableJuridico() {
        setTipo("juridica");
    }

    public String getRazonSocial() { return razonSocial; }
    public void setRazonSocial(String razonSocial) { this.razonSocial = razonSocial; }

    public String getCuit() { return cuit; }
    public void setCuit(String cuit) { this.cuit = cuit; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Titular.java]
package com.hotel.hotel_backend.domain;

public class Titular {

    private String nombre;
    private String apellido;
    private String telefono;

    public Titular() {}

    public Titular(String nombre, String apellido, String telefono) {
        this.nombre = nombre;
        this.apellido = apellido;
        this.telefono = telefono;
    }

    public String getNombre() { return nombre; }
    public void setNombre(String nombre) { this.nombre = nombre; }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getTelefono() { return telefono; }
    public void setTelefono(String telefono) { this.telefono = telefono; }
}



// [src/main/java/com/hotel/hotel_backend/dto/ConsumoDTO.java]
package com.hotel.hotel_backend.dto;

public class ConsumoDTO {
    private String descripcion;
    private Double importe;

    public ConsumoDTO() {}

    public String getDescripcion() { return descripcion; }
    public void setDescripcion(String descripcion) { this.descripcion = descripcion; }

    public Double getImporte() { return importe; }
    public void setImporte(Double importe) { this.importe = importe; }
}



// [src/main/java/com/hotel/hotel_backend/dto/DireccionDTO.java]
package com.hotel.hotel_backend.dto;

public class DireccionDTO {
    private String calle;
    private String numero;
    private String departamento;
    private String piso;
    private String codigoPostal;
    private String localidad;
    private String provincia;
    private String pais;

    public DireccionDTO() {}

    public DireccionDTO(String calle, String numero, String departamento, String piso,
                     String codigoPostal, String localidad, String provincia, String pais) {
        this.calle = calle;
        this.numero = numero;
        this.departamento = departamento;
        this.piso = piso;
        this.codigoPostal = codigoPostal;
        this.localidad = localidad;
        this.provincia = provincia;
        this.pais = pais;
    }

    // Getters y setters
    public String getCalle() { return calle; }
    public void setCalle(String calle) { this.calle = calle; }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getDepartamento() { return departamento; }
    public void setDepartamento(String departamento) { this.departamento = departamento; }

    public String getPiso() { return piso; }
    public void setPiso(String piso) { this.piso = piso; }

    public String getCodigoPostal() { return codigoPostal; }
    public void setCodigoPostal(String codigoPostal) { this.codigoPostal = codigoPostal; }

    public String getLocalidad() { return localidad; }
    public void setLocalidad(String localidad) { this.localidad = localidad; }

    public String getProvincia() { return provincia; }
    public void setProvincia(String provincia) { this.provincia = provincia; }

    public String getPais() { return pais; }
    public void setPais(String pais) { this.pais = pais; }

    
}


// [src/main/java/com/hotel/hotel_backend/dto/EstadiaDTO.java]
package com.hotel.hotel_backend.dto;

import java.util.List;

public class EstadiaDTO {

    private Integer id;
    private String fechaCheckIn;
    private String fechaCheckOut;
    private String estado; // EnCurso / Finalizada

    private ReservaDTO reserva;
    private HuespedDTO titular;
    private List<HuespedDTO> acompaniantes;

    private List<ConsumoDTO> consumos; // por ahora puede ir vacÃ­o

    public EstadiaDTO() {}

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public String getFechaCheckIn() { return fechaCheckIn; }
    public void setFechaCheckIn(String fechaCheckIn) { this.fechaCheckIn = fechaCheckIn; }

    public String getFechaCheckOut() { return fechaCheckOut; }
    public void setFechaCheckOut(String fechaCheckOut) { this.fechaCheckOut = fechaCheckOut; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public ReservaDTO getReserva() { return reserva; }
    public void setReserva(ReservaDTO reserva) { this.reserva = reserva; }

    public HuespedDTO getTitular() { return titular; }
    public void setTitular(HuespedDTO titular) { this.titular = titular; }

    public List<HuespedDTO> getAcompaniantes() { return acompaniantes; }
    public void setAcompaniantes(List<HuespedDTO> acompaniantes) { this.acompaniantes = acompaniantes; }

    public List<ConsumoDTO> getConsumos() { return consumos; }
    public void setConsumos(List<ConsumoDTO> consumos) { this.consumos = consumos; }
}



// [src/main/java/com/hotel/hotel_backend/dto/FacturaDTO.java]
package com.hotel.hotel_backend.dto;

import com.hotel.hotel_backend.dto.MedioDePago.MedioDePagoDTO;
import com.hotel.hotel_backend.dto.ResponsableDePago.ResponsableDePagoDTO;

import java.util.List;

public class FacturaDTO {

    private int id;
    private String hora;
    private String fecha;
    private String tipo;
    private String estado;

    private ResponsableDePagoDTO responsableDePago; // â† puede ser Huesped o JurÃ­dica
    private MedioDePagoDTO medioDePago;             // â† Tarjeta/Efectivo/Cheque/Extranjera/null

    private EstadiaDTO estadia;

    private List<PagoDTO> pagos;                   // â† lista vacÃ­a al crear
    private double total;
    private double iva;
    private String detalle;
    private String horaSalida;

    public FacturaDTO(int id, String hora, String fecha, String tipo, String estado,
                      ResponsableDePagoDTO responsableDePago, MedioDePagoDTO medioDePago,
                      EstadiaDTO estadia, List<PagoDTO> pagos,
                      double total, double iva, String detalle, String horaSalida) {

        this.id = id;
        this.hora = hora;
        this.fecha = fecha;
        this.tipo = tipo;
        this.estado = estado;
        this.responsableDePago = responsableDePago;
        this.medioDePago = medioDePago;
        this.estadia = estadia;
        this.pagos = pagos;
        this.total = total;
        this.iva = iva;
        this.detalle = detalle;
        this.horaSalida = horaSalida;
    }

    // ---------------- Getters & Setters ------------------

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public String getHora() { return hora; }
    public void setHora(String hora) { this.hora = hora; }

    public String getFecha() { return fecha; }
    public void setFecha(String fecha) { this.fecha = fecha; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public ResponsableDePagoDTO getResponsableDePago() { return responsableDePago; }
    public void setResponsableDePago(ResponsableDePagoDTO responsableDePago) { this.responsableDePago = responsableDePago; }

    public MedioDePagoDTO getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePagoDTO medioDePago) { this.medioDePago = medioDePago; }

    public EstadiaDTO getEstadia() { return estadia; }
    public void setEstadia(EstadiaDTO estadia) { this.estadia = estadia; }

    public List<PagoDTO> getPagos() { return pagos; }
    public void setPagos(List<PagoDTO> pagos) { this.pagos = pagos; }

    public double getTotal() { return total; }
    public void setTotal(double total) { this.total = total; }

    public double getIva() { return iva; }
    public void setIva(double iva) { this.iva = iva; }

    public String getDetalle() { return detalle; }
    public void setDetalle(String detalle) { this.detalle = detalle; }

    public String getHoraSalida() { return horaSalida; }
    public void setHoraSalida(String horaSalida) { this.horaSalida = horaSalida; }
}



// [src/main/java/com/hotel/hotel_backend/dto/HabitacionDTO.java]
package com.hotel.hotel_backend.dto;

public class HabitacionDTO {

    private int numero;
    private String tipo;
    private String categoria;
    private double costoPorNoche;
    private String estado;

    public HabitacionDTO() {}

    public int getNumero() { return numero; }
    public void setNumero(int numero) { this.numero = numero; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getCategoria() { return categoria; }
    public void setCategoria(String categoria) { this.categoria = categoria; }

    public double getCostoPorNoche() { return costoPorNoche; }
    public void setCostoPorNoche(double costoPorNoche) { this.costoPorNoche = costoPorNoche; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }
}



// [src/main/java/com/hotel/hotel_backend/dto/HuespedDTO.java]
package com.hotel.hotel_backend.dto;

public class HuespedDTO {
    private String nombre;
    private String apellido;
    private String tipoDocumento;
    private String numeroDocumento;
    private String ocupacion;
    private String nacionalidad;
    private String cuit;
    private String email;

    private DireccionDTO direccion; // puede ser null
    private String condicionIVA;    // puede ser null

    public HuespedDTO() {}

    public String getNombre() { return nombre; }
    public void setNombre(String nombre) { this.nombre = nombre; }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getTipoDocumento() { return tipoDocumento; }
    public void setTipoDocumento(String tipoDocumento) { this.tipoDocumento = tipoDocumento; }

    public String getnumeroDocumento() { return numeroDocumento; }
    public void setnumeroDocumento(String numeroDocumento) { this.numeroDocumento = numeroDocumento; }

    public String getOcupacion() { return ocupacion; }
    public void setOcupacion(String ocupacion) { this.ocupacion = ocupacion; }

    public String getNacionalidad() { return nacionalidad; }
    public void setNacionalidad(String nacionalidad) { this.nacionalidad = nacionalidad; }

    public String getCuit() { return cuit; }
    public void setCuit(String cuit) { this.cuit = cuit; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public DireccionDTO getDireccion() { return direccion; }
    public void setDireccion(DireccionDTO direccion) { this.direccion = direccion; }

    public String getCondicionIVA() { return condicionIVA; }
    public void setCondicionIVA(String condicionIVA) { this.condicionIVA = condicionIVA; }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/ChequeDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class ChequeDTO extends MedioDePagoDTO {

    private String numero;
    private String fechaVencimiento;

    public ChequeDTO() {}

    public ChequeDTO(String numero, double monto, String fechaVencimiento) {
        super(monto);
        this.numero = numero;
        this.fechaVencimiento = fechaVencimiento;
    }

    @Override
    public String getTipo() {
        return "Cheque";
    }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getFechaVencimiento() { return fechaVencimiento; }
    public void setFechaVencimiento(String fechaVencimiento) { this.fechaVencimiento = fechaVencimiento; }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/EfectivoDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class EfectivoDTO extends MedioDePagoDTO {

    public EfectivoDTO() {}

    public EfectivoDTO(double monto) {
        super(monto);
    }

    @Override
    public String getTipo() {
        return "Efectivo";
    }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/MedioDePagoDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;

@JsonTypeInfo(
        use = JsonTypeInfo.Id.NAME,
        include = JsonTypeInfo.As.PROPERTY,
        property = "tipo"
)
@JsonSubTypes({
        @JsonSubTypes.Type(value = TarjetaDTO.class, name = "tarjeta"),
        @JsonSubTypes.Type(value = ChequeDTO.class, name = "cheque"),
        @JsonSubTypes.Type(value = MonedaExtranjeraDTO.class, name = "monedaExtranjera"),
        @JsonSubTypes.Type(value = EfectivoDTO.class, name = "efectivo")
})

public abstract class MedioDePagoDTO {

    private double monto;

    public MedioDePagoDTO() {}

    public MedioDePagoDTO(double monto) {
        this.monto = monto;
    }

    public double getMonto() { return monto; }
    public void setMonto(double monto) { this.monto = monto; }

    public abstract String getTipo();
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/MonedaExtranjeraDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class MonedaExtranjeraDTO extends MedioDePagoDTO {

    private String tipoMoneda;
    private double montoExtranjero;
    private double cotizacion;

    public MonedaExtranjeraDTO() {}

    public MonedaExtranjeraDTO(String tipoMoneda, double montoExtranjero,
                            double cotizacion, double monto) {
        super(monto);
        this.tipoMoneda = tipoMoneda;
        this.montoExtranjero = montoExtranjero;
        this.cotizacion = cotizacion;
    }

    @Override
    public String getTipo() {
        return "MonedaExtranjera";
    }

    public String getTipoMoneda() { return tipoMoneda; }
    public void setTipoMoneda(String tipoMoneda) { this.tipoMoneda = tipoMoneda; }

    public double getMontoExtranjero() { return montoExtranjero; }
    public void setMontoExtranjero(double montoExtranjero) { this.montoExtranjero = montoExtranjero; }

    public double getCotizacion() { return cotizacion; }
    public void setCotizacion(double cotizacion) { this.cotizacion = cotizacion; }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/TarjetaDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class TarjetaDTO extends MedioDePagoDTO {

    private String tipoTarjeta;     
    private String numeroTarjeta;

    public TarjetaDTO() {}

    public TarjetaDTO(String tipoTarjeta, String numeroTarjeta, double monto) {
        super(monto);
        this.tipoTarjeta = tipoTarjeta;
        this.numeroTarjeta = numeroTarjeta;
    }

    @Override
    public String getTipo() {
        return "Tarjeta";
    }

    public String getTipoTarjeta() { return tipoTarjeta; }
    public void setTipoTarjeta(String tipoTarjeta) { this.tipoTarjeta = tipoTarjeta; }

    public String getNumeroTarjeta() { return numeroTarjeta; }
    public void setNumeroTarjeta(String numeroTarjeta) { this.numeroTarjeta = numeroTarjeta; }
}



// [src/main/java/com/hotel/hotel_backend/dto/NotaDeCreditoDTO.java]
package com.hotel.hotel_backend.dto;

import com.hotel.hotel_backend.dto.ResponsableDePago.ResponsableDePagoDTO;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

public class NotaDeCreditoDTO {

    private Integer idNota;
    private LocalDate fecha;
    private ResponsableDePagoDTO responsable;
    private List<FacturaDTO> facturas;
    private String tipo;



    public NotaDeCreditoDTO(Integer idNota, LocalDate fecha, 
                         ResponsableDePagoDTO responsable, 
                         List<FacturaDTO> facturas,
                         String tipo) {
            this.idNota = idNota;
            this.fecha = fecha != null ? fecha : LocalDate.now();
            this.responsable = responsable;
            this.facturas = facturas != null ? facturas : new ArrayList<>();
            this.tipo = tipo;
    }

    public Integer getIdNota() { return idNota; }
    public void setIdNota(Integer idNota) { this.idNota = idNota; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public ResponsableDePagoDTO getResponsable() { return responsable; }
    public void setResponsable(ResponsableDePagoDTO responsable) { this.responsable = responsable; }

    public List<FacturaDTO> getFacturas() { return facturas; }
    public void setFacturas(List<FacturaDTO> facturas) { this.facturas = facturas; }


    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

}



// [src/main/java/com/hotel/hotel_backend/dto/PagoDTO.java]
package com.hotel.hotel_backend.dto;
import com.hotel.hotel_backend.dto.MedioDePago.MedioDePagoDTO;

public class PagoDTO {

    private int id;
    private String fecha;
    private String hora;
    private double montoTotal;
    private MedioDePagoDTO medioDePago;

    public PagoDTO() {}

    public PagoDTO(int id, String fecha, String hora, double montoTotal, MedioDePagoDTO medioDePago) {
        this.id = id;
        this.fecha = fecha;
        this.hora = hora;
        this.montoTotal = montoTotal;
        this.medioDePago = medioDePago;
    }

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public String getFecha() { return fecha; }
    public void setFecha(String fecha) { this.fecha = fecha; }

    public String getHora() { return hora; }
    public void setHora(String hora) { this.hora = hora; }

    public double getMontoTotal() { return montoTotal; }
    public void setMontoTotal(double montoTotal) { this.montoTotal = montoTotal; }

    public MedioDePagoDTO getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePagoDTO medioDePago) { this.medioDePago = medioDePago; }
}



// [src/main/java/com/hotel/hotel_backend/dto/ReservaDTO.java]
package com.hotel.hotel_backend.dto;

import java.util.List;

public class ReservaDTO {

    private Integer id;                    
    private String fechaInicio;
    private String fechaFin;
    private String estado;                 
    private TitularDTO titular;
    private List<HabitacionDTO> habitaciones;

    public ReservaDTO() {}

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public String getFechaInicio() { return fechaInicio; }
    public void setFechaInicio(String fechaInicio) { this.fechaInicio = fechaInicio; }

    public String getFechaFin() { return fechaFin; }
    public void setFechaFin(String fechaFin) { this.fechaFin = fechaFin; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public TitularDTO getTitular() { return titular; }
    public void setTitular(TitularDTO titular) { this.titular = titular; }

    public List<HabitacionDTO> getHabitaciones() { return habitaciones; }
    public void setHabitaciones(List<HabitacionDTO> habitaciones) { this.habitaciones = habitaciones; }

}



// [src/main/java/com/hotel/hotel_backend/dto/ResponsableDePago/ResponsableDePagoDTO.java]
package com.hotel.hotel_backend.dto.ResponsableDePago;

import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;

@JsonTypeInfo(
        use = JsonTypeInfo.Id.NAME,
        include = JsonTypeInfo.As.PROPERTY,
        property = "tipo"
)
@JsonSubTypes({
        @JsonSubTypes.Type(value = ResponsableHuespedDTO.class, name = "huesped"),
        @JsonSubTypes.Type(value = ResponsableJuridicoDTO.class, name = "juridica")
})
public abstract class ResponsableDePagoDTO {
    private String tipo; // "huesped" o "juridica"

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }
}



// [src/main/java/com/hotel/hotel_backend/dto/ResponsableDePago/ResponsableHuespedDTO.java]
package com.hotel.hotel_backend.dto.ResponsableDePago;

public class ResponsableHuespedDTO extends ResponsableDePagoDTO {

    private String apellido;
    private String nombres;
    private String documento;

    public ResponsableHuespedDTO() {
        setTipo("huesped");
    }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getNombres() { return nombres; }
    public void setNombres(String nombres) { this.nombres = nombres; }

    public String getDocumento() { return documento; }
    public void setDocumento(String documento) { this.documento = documento; }

}



// [src/main/java/com/hotel/hotel_backend/dto/ResponsableDePago/ResponsableJuridicoDTO.java]
package com.hotel.hotel_backend.dto.ResponsableDePago;

public class ResponsableJuridicoDTO extends ResponsableDePagoDTO {

    private String razonSocial;
    private String cuit;

    public ResponsableJuridicoDTO() {
        setTipo("juridica");
    }

    public String getRazonSocial() { return razonSocial; }
    public void setRazonSocial(String razonSocial) { this.razonSocial = razonSocial; }

    public String getCuit() { return cuit; }
    public void setCuit(String cuit) { this.cuit = cuit; }
}



// [src/main/java/com/hotel/hotel_backend/dto/TitularDTO.java]
package com.hotel.hotel_backend.dto;

public class TitularDTO {

    private String nombre;
    private String apellido;
    private String telefono;

    public TitularDTO() {}

    public TitularDTO(String nombre, String apellido, String telefono) {
        this.nombre = nombre;
        this.apellido = apellido;
        this.telefono = telefono;
    }

    public String getNombre() { return nombre; }
    public void setNombre(String nombre) { this.nombre = nombre; }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getTelefono() { return telefono; }
    public void setTelefono(String telefono) { this.telefono = telefono; }
}



// [src/main/java/com/hotel/hotel_backend/HotelBackendApplication.java]
package com.hotel.hotel_backend;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;


@SpringBootApplication
public class HotelBackendApplication {
    public static void main(String[] args) {
        SpringApplication.run(HotelBackendApplication.class, args);
    }
}



// [src/main/java/com/hotel/hotel_backend/service/EstadiaService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.EstadiaDAO;
import com.hotel.hotel_backend.dao.ReservaDAO;
import com.hotel.hotel_backend.domain.Estadia;
import com.hotel.hotel_backend.domain.Reserva;
import com.hotel.hotel_backend.dto.*;
import com.hotel.hotel_backend.service.Mapeo.MapearADTO;
import com.hotel.hotel_backend.service.Mapeo.MapearADominio;


public class EstadiaService {

    private final EstadiaDAO estadiaDAO;
    private final ReservaDAO reservaDAO;
    private final HabitacionService habitacionService;

    public EstadiaService(EstadiaDAO estadiaDAO,
                          ReservaDAO reservaDAO,
                          HabitacionService habitacionService) {
        this.estadiaDAO = estadiaDAO;
        this.reservaDAO = reservaDAO;
        this.habitacionService = habitacionService;
    }
    
    public String generarEstadia(EstadiaDTO dto) {

        int idReserva = dto.getReserva().getId();

        Reserva reserva = reservaDAO.findById(idReserva)
                .orElseThrow(() -> new RuntimeException("No existe la reserva con id " + idReserva));

        for (Integer nro : reserva.getHabitaciones()) {
            var hab = habitacionService.buscarPorNumero(nro);
            if (hab == null)
                throw new RuntimeException("La habitaciÃ³n " + nro + " no existe.");
            if (!hab.getEstado().equalsIgnoreCase("Reservada"))
                throw new RuntimeException("La habitaciÃ³n " + nro + " no estÃ¡ reservada para generar la estadÃ­a.");
        }

        
        reserva.setEstado("Confirmada");
        reservaDAO.update(reserva);

        // Ocupamos habitaciones
        for (Integer nro : reserva.getHabitaciones()) {
            habitacionService.cambiarEstado(nro, "Ocupada");
        }

        
        estadiaDAO.save(MapearADominio.mapearEstadia(dto));
        return "Estadia generada correctamente.";
    }

    public EstadiaDTO obtenerEstadiaActivaPorHabitacion(int numeroHabitacion) {

        Estadia estadia = estadiaDAO.findActivaByHabitacion(numeroHabitacion)
                .orElseThrow(() -> new RuntimeException(
                        "La habitaciÃ³n " + numeroHabitacion + " no tiene estadÃ­a activa."
                ));

        return MapearADTO.mapearEstadia(estadia);
    }

    
}



// [src/main/java/com/hotel/hotel_backend/service/FacturaService.java]
package com.hotel.hotel_backend.service;

import java.time.LocalDate;
import java.util.List;

import com.hotel.hotel_backend.dao.FacturaDAO;
import com.hotel.hotel_backend.dto.FacturaDTO;
import com.hotel.hotel_backend.dto.NotaDeCreditoDTO;
import com.hotel.hotel_backend.dto.PagoDTO;
import com.hotel.hotel_backend.service.Mapeo.MapearADTO;
import com.hotel.hotel_backend.service.Mapeo.MapearADominio;
import com.hotel.hotel_backend.domain.Factura;
import com.hotel.hotel_backend.domain.NotaDeCredito;

public class FacturaService {

    private final FacturaDAO facturaDAO;

    public FacturaService(FacturaDAO facturaDAO) {
        this.facturaDAO = facturaDAO;
    }

    public String generarFactura(FacturaDTO dto) {
        Factura factura = MapearADominio.mapearFactura(dto);
        facturaDAO.save(factura);
        return "Factura generada correctamente.";
    }

    public List<FacturaDTO> obtenerPendientesPorHabitacion(int numeroHabitacion) {
        List<Factura> lista = facturaDAO.findPendientesByHabitacion(numeroHabitacion);
        
        return lista.stream().map(f -> MapearADTO.mapearFactura(f)).toList(); 
    }

    public String actualizarFactura(FacturaDTO dto) {
        Factura factura = MapearADominio.mapearFactura(dto);
        facturaDAO.update(factura);
        return "Factura actualizada correctamente.";
    }

    public FacturaDTO obtenerFacturaPorId(int id) {
        Factura factura = facturaDAO.findById(id)
                .orElseThrow(() -> new RuntimeException("Factura no encontrada con ID " + id));
        return MapearADTO.mapearFactura(factura);
    }

    public List<FacturaDTO> listarTodas() {
        List<Factura> lista = facturaDAO.findAll();
        return lista.stream().map(f-> MapearADTO.mapearFactura(f)).toList(); 
    }

    public List<PagoDTO> buscarPagoesEntreFechas(LocalDate desde, LocalDate hasta) {
        return facturaDAO.findPagosEntreFechas(desde, hasta)
                .stream()
                .map(MapearADTO::mapearPago)
                .toList();
    }

    public List<PagoDTO> buscarChequesEntreFechas(LocalDate desde, LocalDate hasta) {
        return facturaDAO.findChequesEntreFechas(desde, hasta)
                .stream()
                .map(MapearADTO::mapearPago)
                .toList();
    }

    public NotaDeCreditoDTO crearNotaDeCredito(NotaDeCreditoDTO dto) {
        NotaDeCredito nota = MapearADominio.mapearNotaDeCredito(dto);

        facturaDAO.saveNota(nota);

        return MapearADTO.mapearNotaDeCredito(nota);
    }

}



// [src/main/java/com/hotel/hotel_backend/service/HabitacionService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.HabitacionDAO;
import com.hotel.hotel_backend.domain.Habitacion;
import com.hotel.hotel_backend.dto.HabitacionDTO;

import java.util.List;

public class HabitacionService {

    private final HabitacionDAO habitacionDAO;

    public HabitacionService(HabitacionDAO habitacionDAO) {
        this.habitacionDAO = habitacionDAO;
    }

    // ==========================================================
    // LISTAR TODAS
    // ==========================================================
    public List<Habitacion> listarTodas() {
        return habitacionDAO.findAll();
    }

    // ==========================================================
    // BUSCAR POR NUMERO (puede devolver null)
    // ==========================================================
    public Habitacion buscarPorNumero(int numero) {
        return habitacionDAO.findByNumero(numero).orElse(null);
    }

    // ==========================================================
    // VALIDAR EXISTENCIA
    // ==========================================================
    public void validarExistencia(int numero) {
        if (habitacionDAO.findByNumero(numero).isEmpty()) {
            throw new RuntimeException("La habitaciÃ³n " + numero + " no existe.");
        }
    }

    // ==========================================================
    // VALIDAR DISPONIBILIDAD
    // ==========================================================
    public void validarDisponible(int numero) {
        Habitacion h = buscarPorNumero(numero);

        if (h == null)
            throw new RuntimeException("La habitaciÃ³n " + numero + " no existe.");

        if (!h.getEstado().equalsIgnoreCase("Disponible")) {
            System.err.println("h.getEstado() = " + h.getEstado());
            throw new RuntimeException("La habitaciÃ³n " + numero + " no estÃ¡ disponible.");
        }
    }

    // ==========================================================
    // CAMBIAR ESTADO
    // ==========================================================
    public void cambiarEstado(int numero, String nuevoEstado) {
        Habitacion h = buscarPorNumero(numero);

        if (h == null)
            throw new RuntimeException("No existe la habitaciÃ³n " + numero);

        h.setEstado(nuevoEstado);
        habitacionDAO.update(h);
    }

    // ==========================================================
    // LISTAR SOLO LAS DISPONIBLES
    // ==========================================================
    public List<Habitacion> listarDisponibles() {
        return habitacionDAO.findAll()
                .stream()
                .filter(h -> h.getEstado().equalsIgnoreCase("Disponible"))
                .toList();
    }

    // ==========================================================
    // VALIDAR LISTA DE HABITACIONES (DTO COMPLETO)
    // ==========================================================
    public void validarHabitacionesDisponibles(List<HabitacionDTO> habitacionesDTO) {
        for (HabitacionDTO dto : habitacionesDTO) {
            int nro = dto.getNumero();
            validarExistencia(nro);
            validarDisponible(nro);
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/service/HuespedService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.HuespedDAO;
import com.hotel.hotel_backend.domain.Huesped;

import java.util.List;

public class HuespedService {

    private final HuespedDAO huespedDAO;

    public HuespedService(HuespedDAO huespedDAO) {
        this.huespedDAO = huespedDAO;
    }

    public void darAlta(Huesped h) {

        if (huespedDAO.findByNumeroDocumento(h.getNumeroDocumento()).isPresent()) {
            throw new RuntimeException("Ya existe un huÃ©sped con ese tipo y nÃºmero de documento");
        }

        if (h.getCuit() != null && !h.getCuit().isEmpty()) {
            if (huespedDAO.findByCuit(h.getCuit()).isPresent()) {
                throw new RuntimeException("Ya existe un huÃ©sped con ese CUIT");
            }
        }

        huespedDAO.save(h);
    }


    public List<Huesped> buscarConFiltros(String apellido, String nombre, String tipoDocumento, String numeroDocumento) {

        // Tomo todos los huÃ©spedes
        List<Huesped> todos = huespedDAO.findAll();

        // SI TODOS los parÃ¡metros vienen vacÃ­os â†’ retorno lista completa
        if ((apellido == null || apellido.isEmpty()) &&
            (nombre == null || nombre.isEmpty()) &&
            (tipoDocumento == null || tipoDocumento.isEmpty()) &&
            (numeroDocumento == null || numeroDocumento.isEmpty())) {

            return todos;
        }

        // Sino, filtro segÃºn los que estÃ©n completos
        return todos.stream()
                .filter(h -> (apellido == null || apellido.isEmpty() ||
                        h.getApellido().startsWith(apellido)))
                .filter(h -> (nombre == null || nombre.isEmpty() ||
                        h.getNombre().startsWith(nombre)))
                .filter(
                    h -> (tipoDocumento == null || tipoDocumento.isEmpty() ||
                        h.getTipoDocumento().equalsIgnoreCase(tipoDocumento))
                    )
                .filter(
                    h -> (numeroDocumento == null || numeroDocumento.isEmpty() ||
                        h.getNumeroDocumento().startsWith(numeroDocumento))
                    )
                .toList();
    }

    public Huesped modificarHuesped(Huesped nuevosDatos) {
        Huesped existente = huespedDAO.findByNumeroDocumento(nuevosDatos.getNumeroDocumento())
        .orElseThrow(() -> new RuntimeException("No existe un huÃ©sped con ese documento"));


        // Actualizar todos los campos
        existente.setApellido(nuevosDatos.getApellido());
        existente.setNombre(nuevosDatos.getNombre());
        existente.setTipoDocumento(nuevosDatos.getTipoDocumento());
        existente.setCuit(nuevosDatos.getCuit());
        existente.setPosicionIVA(nuevosDatos.getPosicionIVA());
        existente.setDireccion(nuevosDatos.getDireccion());
        existente.setEmail(nuevosDatos.getEmail());
        existente.setOcupacion(nuevosDatos.getOcupacion());
        existente.setNacionalidad(nuevosDatos.getNacionalidad());
        existente.setDireccionCompleta(nuevosDatos.getDireccion());

        huespedDAO.update(existente);
        return existente;
    }



    public List<Huesped> listar() {
        return huespedDAO.findAll();
    }
}



// [src/main/java/com/hotel/hotel_backend/service/Mapeo/MapearADominio.java]
package com.hotel.hotel_backend.service.Mapeo;

import com.hotel.hotel_backend.domain.*;
import com.hotel.hotel_backend.domain.MedioDePago.*;
import com.hotel.hotel_backend.domain.ResponsableDePago.*;
import com.hotel.hotel_backend.dto.*;
import com.hotel.hotel_backend.dto.MedioDePago.*;
import com.hotel.hotel_backend.dto.ResponsableDePago.*;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

public class MapearADominio {

    public static Direccion mapearDireccion(DireccionDTO dto) {
        if (dto == null) return null;
        return new Direccion(
                dto.getCalle(),
                dto.getNumero(),
                dto.getDepartamento(),
                dto.getPiso(),
                dto.getCodigoPostal(),
                dto.getLocalidad(),
                dto.getProvincia(),
                dto.getPais()
        );
    }

    public static Huesped mapearHuesped(HuespedDTO dto) {
        if (dto == null) return null;
        return new Huesped(
                dto.getApellido(),
                dto.getNombre(),
                dto.getTipoDocumento(),
                dto.getnumeroDocumento(),
                dto.getCuit(),
                dto.getCondicionIVA(),
                mapearDireccion(dto.getDireccion()),
                dto.getEmail(),
                dto.getOcupacion(),
                dto.getNacionalidad()
        );
    }

    public static Titular mapearTitular(TitularDTO dto) {
        if (dto == null) return null;
        return new Titular(
                dto.getNombre(),
                dto.getApellido(),
                dto.getTelefono()
        );
    }

    public static Habitacion mapearHabitacion(HabitacionDTO dto) {
        if (dto == null) return null;
        return new Habitacion(
                dto.getNumero(),
                dto.getTipo(),
                dto.getCategoria(),
                dto.getCostoPorNoche(),
                dto.getEstado()
        );
    }

    public static MedioDePago mapearMedioDePago(MedioDePagoDTO dto) {
        if (dto == null) return null;

        if (dto instanceof TarjetaDTO t)
            return new Tarjeta(t.getTipoTarjeta(), t.getNumeroTarjeta(), t.getMonto());

        if (dto instanceof ChequeDTO c)
            return new Cheque(c.getNumero(), c.getMonto(), c.getFechaVencimiento());

        if (dto instanceof MonedaExtranjeraDTO m)
            return new MonedaExtranjera(m.getTipoMoneda(), m.getMontoExtranjero(), m.getCotizacion(), m.getMonto());

        if (dto instanceof EfectivoDTO e)
            return new Efectivo(e.getMonto());

        throw new RuntimeException("Tipo de medio de pago desconocido: " + dto.getClass());
    }

    public static ResponsableDePago mapearResponsableDePago(ResponsableDePagoDTO dto) {
        if (dto == null) return null;

        if (dto instanceof ResponsableHuespedDTO h) {
            ResponsableHuesped r = new ResponsableHuesped();
            r.setApellido(h.getApellido());
            r.setNombres(h.getNombres());
            r.setDocumento(h.getDocumento());
            return r;
        }

        if (dto instanceof ResponsableJuridicoDTO j) {
            ResponsableJuridico r = new ResponsableJuridico();
            r.setRazonSocial(j.getRazonSocial());
            r.setCuit(j.getCuit());
            return r;
        }

        throw new RuntimeException("Tipo de responsable desconocido: " + dto.getClass());
    }

    public static Pago mapearPago(PagoDTO dto) {
        if (dto == null) return null;
        return new Pago(
                dto.getId(),
                dto.getFecha(),
                dto.getHora(),
                dto.getMontoTotal(),
                mapearMedioDePago(dto.getMedioDePago())
        );
    }

    public static List<Pago> mapearPagos(List<PagoDTO> dto) {
        if (dto == null) return new ArrayList<>();
        return dto.stream().map(MapearADominio::mapearPago).collect(Collectors.toList());
    }

    public static Reserva mapearReserva(ReservaDTO dto) {
        if (dto == null) return null;

        LocalDate inicio = stringToFecha(dto.getFechaInicio());
        LocalDate fin = stringToFecha(dto.getFechaFin());

        List<Integer> habitaciones = new ArrayList<>();
        if (dto.getHabitaciones() != null) {
            habitaciones = dto.getHabitaciones().stream()
                    .map(HabitacionDTO::getNumero)
                    .collect(Collectors.toList());
        }

        return new Reserva(
                dto.getId() != null ? dto.getId() : 0,
                inicio,
                fin,
                mapearTitular(dto.getTitular()),
                habitaciones,
                dto.getEstado()
        );
    }

    public static Estadia mapearEstadia(EstadiaDTO dto) {
        if (dto == null) return null;

        LocalDate in = stringToFecha(dto.getFechaCheckIn());
        LocalDate out = stringToFecha(dto.getFechaCheckOut());

        List<Huesped> acomp = new ArrayList<>();
        if (dto.getAcompaniantes() != null) {
            acomp = dto.getAcompaniantes().stream()
                    .map(MapearADominio::mapearHuesped)
                    .collect(Collectors.toList());
        }

        int idReserva = dto.getReserva() != null && dto.getReserva().getId() != null
                ? dto.getReserva().getId()
                : 0;

        return new Estadia(
                dto.getId() != null ? dto.getId() : 0,
                in,
                out,
                dto.getEstado(),
                idReserva,
                mapearHuesped(dto.getTitular()),
                acomp
        );
    }

    public static Factura mapearFactura(FacturaDTO dto) {
        if (dto == null) return null;

        return new Factura(
                dto.getId(),
                dto.getHora(),
                dto.getFecha(),
                dto.getTipo(),
                dto.getEstado(),
                mapearResponsableDePago(dto.getResponsableDePago()),
                mapearMedioDePago(dto.getMedioDePago()),
                mapearEstadia(dto.getEstadia()),
                mapearPagos(dto.getPagos()),
                dto.getTotal(),
                dto.getIva(),
                dto.getDetalle(),
                dto.getHoraSalida()
        );
    }

    public static LocalDate stringToFecha(String f) {
        if (f == null || f.isEmpty()) return null;
        return LocalDate.parse(f);
    }

    public static NotaDeCredito mapearNotaDeCredito(NotaDeCreditoDTO dto) {
        if (dto == null) return null;

        return new NotaDeCredito(
            dto.getIdNota(),
            dto.getFecha(),
            mapearResponsableDePago(dto.getResponsable()),
            dto.getFacturas() != null
                ? dto.getFacturas()
                    .stream()
                    .map(MapearADominio::mapearFactura)
                    .collect(Collectors.toList())
                : new ArrayList<>(),
            dto.getTipo()
        );
    }

    

}



// [src/main/java/com/hotel/hotel_backend/service/Mapeo/MapearADTO.java]
package com.hotel.hotel_backend.service.Mapeo;

import com.hotel.hotel_backend.domain.*;
import com.hotel.hotel_backend.domain.MedioDePago.*;
import com.hotel.hotel_backend.domain.ResponsableDePago.*;
import com.hotel.hotel_backend.dto.*;
import com.hotel.hotel_backend.dto.MedioDePago.*;
import com.hotel.hotel_backend.dto.ResponsableDePago.*;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

public class MapearADTO {

    public static DireccionDTO mapearDireccion(Direccion direccion) {
        if (direccion == null) return null;
        return new DireccionDTO(
                direccion.getCalle(),
                direccion.getNumero(),
                direccion.getDepartamento(),
                direccion.getPiso(),
                direccion.getCodigoPostal(),
                direccion.getLocalidad(),
                direccion.getProvincia(),
                direccion.getPais()
        );
    }

    public static HuespedDTO mapearHuesped(Huesped h) {
        if (h == null) return null;
        HuespedDTO dto = new HuespedDTO();
        dto.setNombre(h.getNombre());
        dto.setApellido(h.getApellido());
        dto.setTipoDocumento(h.getTipoDocumento());
        dto.setnumeroDocumento(h.getNumeroDocumento());
        dto.setOcupacion(h.getOcupacion());
        dto.setNacionalidad(h.getNacionalidad());
        dto.setCuit(h.getCuit());
        dto.setEmail(h.getEmail());
        dto.setCondicionIVA(h.getPosicionIVA());
        dto.setDireccion(mapearDireccion(h.getDireccion()));
        return dto;
    }

    public static TitularDTO mapearTitular(Titular t) {
        if (t == null) return null;
        return new TitularDTO(t.getNombre(), t.getApellido(), t.getTelefono());
    }

    public static HabitacionDTO mapearHabitacion(Habitacion h) {
        if (h == null) return null;
        HabitacionDTO dto = new HabitacionDTO();
        dto.setNumero(h.getNumero());
        dto.setTipo(h.getTipo());
        dto.setCategoria(h.getCategoria());
        dto.setCostoPorNoche(h.getCostoPorNoche());
        dto.setEstado(h.getEstado());
        return dto;
    }

    public static MedioDePagoDTO mapearMedioDePago(MedioDePago m) {
        if (m == null) return null;

        if (m instanceof Tarjeta t)
            return new TarjetaDTO(t.getTipoTarjeta(), t.getNumeroTarjeta(), t.getMonto());

        if (m instanceof Cheque c)
            return new ChequeDTO(c.getNumero(), c.getMonto(), c.getFechaVencimiento());

        if (m instanceof MonedaExtranjera me)
            return new MonedaExtranjeraDTO(me.getTipoMoneda(), me.getMontoExtranjero(), me.getCotizacion(), me.getMonto());

        if (m instanceof Efectivo e)
            return new EfectivoDTO(e.getMonto());

        throw new RuntimeException("Tipo de medio desconocido: " + m.getClass());
    }

    public static ResponsableDePagoDTO mapearResponsableDePago(ResponsableDePago r) {
        if (r == null) return null;

        if (r instanceof ResponsableHuesped h) {
            ResponsableHuespedDTO dto = new ResponsableHuespedDTO();
            dto.setApellido(h.getApellido());
            dto.setNombres(h.getNombres());
            dto.setDocumento(h.getDocumento());
            return dto;
        }

        if (r instanceof ResponsableJuridico j) {
            ResponsableJuridicoDTO dto = new ResponsableJuridicoDTO();
            dto.setRazonSocial(j.getRazonSocial());
            dto.setCuit(j.getCuit());
            return dto;
        }

        throw new RuntimeException("Tipo de responsable desconocido: " + r.getClass());
    }

    public static PagoDTO mapearPago(Pago p) {
        if (p == null) return null;
        return new PagoDTO(
                p.getId(),
                p.getFecha(),
                p.getHora(),
                p.getMontoTotal(),
                mapearMedioDePago(p.getMedioDePago())
        );
    }

    public static List<PagoDTO> mapearPagos(List<Pago> pagos) {
        if (pagos == null) return new ArrayList<>();
        return pagos.stream().map(MapearADTO::mapearPago).collect(Collectors.toList());
    }

    public static ReservaDTO mapearReserva(Reserva r) {
        if (r == null) return null;
        ReservaDTO dto = new ReservaDTO();
        dto.setId(r.getId());
        dto.setFechaInicio(fechaToString(r.getFechaInicio()));
        dto.setFechaFin(fechaToString(r.getFechaFin()));
        dto.setEstado(r.getEstado());
        dto.setTitular(mapearTitular(r.getTitular()));
        dto.setHabitaciones(new ArrayList<>());
        return dto;
    }

    public static EstadiaDTO mapearEstadia(Estadia e) {
        if (e == null) return null;
        EstadiaDTO dto = new EstadiaDTO();
        dto.setId(e.getId());
        dto.setFechaCheckIn(fechaToString(e.getFechaCheckIn()));
        dto.setFechaCheckOut(fechaToString(e.getFechaCheckOut()));
        dto.setEstado(e.getEstado());
        dto.setTitular(mapearHuesped(e.getTitular()));
        if (e.getAcompaniantes() != null) {
            dto.setAcompaniantes(
                    e.getAcompaniantes().stream()
                            .map(MapearADTO::mapearHuesped)
                            .collect(Collectors.toList())
            );
        }
        dto.setReserva(null);
        dto.setConsumos(new ArrayList<>());
        return dto;
    }

    public static FacturaDTO mapearFactura(Factura f) {
        if (f == null) return null;
        return new FacturaDTO(
                f.getId(),
                f.getHora(),
                f.getFecha(),
                f.getTipo(),
                f.getEstado(),
                mapearResponsableDePago(f.getResponsableDePago()),
                mapearMedioDePago(f.getMedioDePago()),
                mapearEstadia(f.getEstadia()),
                mapearPagos(f.getPagos()),
                f.getTotal(),
                f.getIva(),
                f.getDetalle(),
                f.getHoraSalida()
        );
    }

    public static String fechaToString(LocalDate fecha) {
        return fecha != null ? fecha.toString() : null;
    }
    public static NotaDeCreditoDTO mapearNotaDeCredito(NotaDeCredito dominio) {
        if (dominio == null) return null;

        return new NotaDeCreditoDTO(
            dominio.getIdNota(),
            dominio.getFecha(),
            mapearResponsableDePago(dominio.getResponsable()),
            dominio.getFacturas() != null
                ? dominio.getFacturas()
                    .stream()
                    .map(MapearADTO::mapearFactura)
                    .collect(Collectors.toList())
                : new ArrayList<>(),
            dominio.getTipo()
        );
    }
}



// [src/main/java/com/hotel/hotel_backend/service/ReservaService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.ReservaDAO;
import com.hotel.hotel_backend.domain.Reserva;
import com.hotel.hotel_backend.domain.Titular;
import com.hotel.hotel_backend.dto.HabitacionDTO;
import com.hotel.hotel_backend.dto.ReservaDTO;
import com.hotel.hotel_backend.dto.TitularDTO;

import java.time.LocalDate;
import java.time.format.DateTimeParseException;
import java.util.List;

public class ReservaService {

    private final ReservaDAO reservaDAO;
    private final HabitacionService habitacionService;

    public ReservaService(ReservaDAO reservaDAO, HabitacionService habitacionService) {
        this.reservaDAO = reservaDAO;
        this.habitacionService = habitacionService;
    }

    public ReservaDTO reservarHabitacion(ReservaDTO dto) {

        LocalDate inicio = parsearFecha(dto.getFechaInicio(), "fechaInicio");
        LocalDate fin = parsearFecha(dto.getFechaFin(), "fechaFin");


        if (dto.getHabitaciones() == null || dto.getHabitaciones().isEmpty()) {
            throw new RuntimeException("Debe seleccionar al menos una habitaciÃ³n.");
        }

        habitacionService.validarHabitacionesDisponibles(dto.getHabitaciones());

        List<Integer> numeros = dto.getHabitaciones()
                .stream()
                .map(HabitacionDTO::getNumero)
                .toList();

        Titular titular = new Titular(
                dto.getTitular().getNombre(),
                dto.getTitular().getApellido(),
                dto.getTitular().getTelefono()
        );

        Reserva reserva = new Reserva(
                0,
                inicio,
                fin,
                titular,
                numeros,
                "Reservada"
        );

        reservaDAO.save(reserva);

        for (int nro : numeros) {
            habitacionService.cambiarEstado(nro, "Reservada");
        }

        dto.setId(reserva.getId());
        dto.setEstado("Reservada");

        return dto;
    }

    private LocalDate parsearFecha(String f, String campo) {
        if (f == null || f.isEmpty()) {
            throw new RuntimeException("El campo " + campo + " es obligatorio.");
        }
        try {
            return LocalDate.parse(f);
        } catch (DateTimeParseException e) {
            throw new RuntimeException("Formato invÃ¡lido en " + campo + ". Use yyyy-MM-dd");
        }
    }

    public List<ReservaDTO> listarReservasEntre(String inicioStr, String finStr) {

        LocalDate inicio = parsearFecha(inicioStr, "inicio");
        LocalDate fin = parsearFecha(finStr, "fin");

        if (fin.isBefore(inicio)) {
            throw new RuntimeException("La fecha final no puede ser anterior a la inicial.");
        }

        // DAO hace el trabajo
        List<Reserva> lista = reservaDAO.findBetween(inicio, fin);

        // Mapear a DTO
        return lista.stream()
                .map(this::mapearReservaADTO)
                .toList();
    }

    private ReservaDTO mapearReservaADTO(Reserva r) {

        // Titular
        TitularDTO titularDTO = new TitularDTO(
                r.getTitular().getNombre(),
                r.getTitular().getApellido(),
                r.getTitular().getTelefono()
        );

        // Habitaciones completas reconstruidas desde el DAO
        List<HabitacionDTO> habitacionesDTO = r.getHabitaciones().stream()
                .map(nro -> {
                    var hab = habitacionService.buscarPorNumero(nro); // DOMINIO REAL

                    HabitacionDTO dto = new HabitacionDTO();
                    dto.setNumero(hab.getNumero());
                    dto.setTipo(hab.getTipo());
                    dto.setCategoria(hab.getCategoria());
                    dto.setCostoPorNoche(hab.getCostoPorNoche());
                    dto.setEstado(hab.getEstado());  // estado real (Disponible/Reservada/Ocupada)
                    return dto;
                })
                .toList();

        // Construir reserva completa
        ReservaDTO dto = new ReservaDTO();
        dto.setId(r.getId());
        dto.setFechaInicio(r.getFechaInicio().toString());
        dto.setFechaFin(r.getFechaFin().toString());
        dto.setEstado(r.getEstado());
        dto.setTitular(titularDTO);
        dto.setHabitaciones(habitacionesDTO);

        return dto;
    }

    public ReservaDTO cancelarReserva(ReservaDTO dto) {

        if (dto.getId() == null) {
            throw new RuntimeException("Debe enviar el ID de la reserva a cancelar.");
        }

        int idReserva = dto.getId();

        // Buscar la reserva REAL en memoria
        Reserva reserva = reservaDAO.findById(idReserva)
                .orElseThrow(() -> new RuntimeException("No existe la reserva con id " + idReserva));

        // Validaciones de estado
        if (reserva.getEstado().equalsIgnoreCase("Cancelada")) {
            throw new RuntimeException("La reserva ya estÃ¡ cancelada.");
        }

        if (reserva.getEstado().equalsIgnoreCase("Confirmada")) {
            throw new RuntimeException("No se puede cancelar una reserva ya confirmada.");
        }

        // Liberar habitaciones reales
        for (Integer nro : reserva.getHabitaciones()) {
            habitacionService.cambiarEstado(nro, "Disponible");
        }

        // Cambiar estado de la reserva REAL
        reserva.setEstado("Cancelada");
        reservaDAO.update(reserva);

        // Devolver DTO COMPLETO reconstruido
        return mapearReservaADTO(reserva);
    }



}



// [src/test/java/com/hotel/hotel_backend/HotelBackendApplicationTests.java]
package com.hotel.hotel_backend;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class HotelBackendApplicationTests {

	@Test
	void contextLoads() {
	}

}



