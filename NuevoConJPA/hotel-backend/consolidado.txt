ğŸ“‚ Estructura del proyecto (.):
-----------------------------------
.
â”œâ”€â”€ consolidado.txt
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ main
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ java
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ com
â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ hotel
â”‚Â Â  â”‚Â Â  â”‚Â Â          â””â”€â”€ hotel_backend
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ config
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ CorsConfig.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ Controller
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ UsuarioController.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ dao
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCreditoDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ UsuarioDAO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ domain
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Direccion.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Estadia.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Factura.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Habitacion.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Huesped.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Cheque.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Efectivo.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePago.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjera.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ Tarjeta.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCredito.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Pago.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Persona.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Reserva.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePago.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuesped.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridico.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ Usuario.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ dto
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ConsumoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ DireccionDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ChequeDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ EfectivoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePagoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjeraDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ TarjetaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCreditoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ PagoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ PersonaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePagoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuespedDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridicoDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”‚Â Â  â””â”€â”€ UsuarioDTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ HotelBackendApplication.java
â”‚Â Â  â”‚Â Â  â”‚Â Â              â””â”€â”€ service
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ EstadiaService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ FacturaService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ HabitacionService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ HuespedService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ Mapeo
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”‚Â Â  â”œâ”€â”€ MapearADominio.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”‚Â Â  â””â”€â”€ MapearADTO.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â”œâ”€â”€ ReservaService.java
â”‚Â Â  â”‚Â Â  â”‚Â Â                  â””â”€â”€ UsuarioService.java
â”‚Â Â  â”‚Â Â  â””â”€â”€ resources
â”‚Â Â  â”‚Â Â      â””â”€â”€ application.properties
â”‚Â Â  â””â”€â”€ test
â”‚Â Â      â””â”€â”€ java
â”‚Â Â          â””â”€â”€ com
â”‚Â Â              â””â”€â”€ hotel
â”‚Â Â                  â””â”€â”€ hotel_backend
â”‚Â Â                      â””â”€â”€ HotelBackendApplicationTests.java
â””â”€â”€ target
    â”œâ”€â”€ classes
    â”‚Â Â  â”œâ”€â”€ application.properties
    â”‚Â Â  â””â”€â”€ com
    â”‚Â Â      â””â”€â”€ hotel
    â”‚Â Â          â””â”€â”€ hotel_backend
    â”‚Â Â              â”œâ”€â”€ config
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ CorsConfig$1.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ CorsConfig.class
    â”‚Â Â              â”œâ”€â”€ Controller
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaController.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaController.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedController.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaController.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ UsuarioController.class
    â”‚Â Â              â”œâ”€â”€ dao
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCreditoDAO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDAO.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ UsuarioDAO.class
    â”‚Â Â              â”œâ”€â”€ domain
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Direccion.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Estadia.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Factura.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Habitacion.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Huesped.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Cheque.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Efectivo.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePago.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjera.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ Tarjeta.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCredito.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Pago.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Persona.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ Reserva.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePago.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuesped.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridico.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ Usuario.class
    â”‚Â Â              â”œâ”€â”€ dto
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ConsumoDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ DireccionDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ EstadiaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ FacturaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HabitacionDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ HuespedDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ MedioDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ChequeDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ EfectivoDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MedioDePagoDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MonedaExtranjeraDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ TarjetaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ NotaDeCreditoDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ PagoDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ PersonaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ReservaDTO.class
    â”‚Â Â              â”‚Â Â  â”œâ”€â”€ ResponsableDePago
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableDePagoDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ResponsableHuespedDTO.class
    â”‚Â Â              â”‚Â Â  â”‚Â Â  â””â”€â”€ ResponsableJuridicoDTO.class
    â”‚Â Â              â”‚Â Â  â””â”€â”€ UsuarioDTO.class
    â”‚Â Â              â”œâ”€â”€ HotelBackendApplication.class
    â”‚Â Â              â””â”€â”€ service
    â”‚Â Â                  â”œâ”€â”€ EstadiaService.class
    â”‚Â Â                  â”œâ”€â”€ FacturaService.class
    â”‚Â Â                  â”œâ”€â”€ HabitacionService.class
    â”‚Â Â                  â”œâ”€â”€ HuespedService.class
    â”‚Â Â                  â”œâ”€â”€ Mapeo
    â”‚Â Â                  â”‚Â Â  â”œâ”€â”€ MapearADominio.class
    â”‚Â Â                  â”‚Â Â  â””â”€â”€ MapearADTO.class
    â”‚Â Â                  â”œâ”€â”€ ReservaService.class
    â”‚Â Â                  â””â”€â”€ UsuarioService.class
    â”œâ”€â”€ generated-sources
    â”‚Â Â  â””â”€â”€ annotations
    â”œâ”€â”€ generated-test-sources
    â”‚Â Â  â””â”€â”€ test-annotations
    â”œâ”€â”€ maven-status
    â”‚Â Â  â””â”€â”€ maven-compiler-plugin
    â”‚Â Â      â”œâ”€â”€ compile
    â”‚Â Â      â”‚Â Â  â””â”€â”€ default-compile
    â”‚Â Â      â”‚Â Â      â”œâ”€â”€ createdFiles.lst
    â”‚Â Â      â”‚Â Â      â””â”€â”€ inputFiles.lst
    â”‚Â Â      â””â”€â”€ testCompile
    â”‚Â Â          â””â”€â”€ default-testCompile
    â”‚Â Â              â”œâ”€â”€ createdFiles.lst
    â”‚Â Â              â””â”€â”€ inputFiles.lst
    â””â”€â”€ test-classes
        â””â”€â”€ com
            â””â”€â”€ hotel
                â””â”€â”€ hotel_backend
                    â””â”€â”€ HotelBackendApplicationTests.class

54 directories, 131 files

-----------------------------------

// [src/main/java/com/hotel/hotel_backend/config/CorsConfig.java]
package com.hotel.hotel_backend.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class CorsConfig {

    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {

            @Override
            public void addCorsMappings(CorsRegistry registry) {

                registry.addMapping("/**")
        .allowedOrigins("*")
        .allowedMethods("*")
        .allowedHeaders("*")
        .allowCredentials(false);

            }
        };
    }
}



// [src/main/java/com/hotel/hotel_backend/Controller/EstadiaController.java]
// [src/main/java/com/hotel/hotel_backend/Controller/EstadiaController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dto.EstadiaDTO;
import com.hotel.hotel_backend.service.EstadiaService;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/estadia")
public class EstadiaController {

    private final EstadiaService estadiaService;

    public EstadiaController(EstadiaService estadiaService) {
        this.estadiaService = estadiaService;
    }

    // ============================================================
    //                        GENERAR ESTADÃA (CHECK-IN)
    // ============================================================
    @PostMapping("/checkin")
    public ResponseEntity<?> generarCheckIn(@RequestBody EstadiaDTO dto) {
        try {
            String respuesta = estadiaService.generarEstadia(dto);
            return ResponseEntity.ok(respuesta);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================================
    //                        CHECK-OUT
    // ============================================================
    @PostMapping("/checkout/{id}")
    public ResponseEntity<?> registrarCheckOut(@PathVariable("id") Integer idEstadia) {
        try {
            EstadiaDTO respuesta = estadiaService.registrarCheckOut(idEstadia);
            return ResponseEntity.ok(respuesta);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================================
    //           OBTENER ESTADÃA ACTIVA POR HABITACIÃ“N
    // ============================================================
    @GetMapping("/activa/{nroHabitacion}")
    public ResponseEntity<?> obtenerActiva(
            @PathVariable("nroHabitacion") int nroHabitacion) {

        try {
            EstadiaDTO dto = estadiaService.obtenerEstadiaActivaPorHabitacion(nroHabitacion);
            return ResponseEntity.ok(dto);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/Controller/FacturaController.java]
// [src/main/java/com/hotel/hotel_backend/Controller/FacturaController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dto.FacturaDTO;
import com.hotel.hotel_backend.dto.NotaDeCreditoDTO;
import com.hotel.hotel_backend.service.FacturaService;

import java.time.LocalDate;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/facturas")
public class FacturaController {

    private final FacturaService facturaService;

    public FacturaController(FacturaService facturaService) {
        this.facturaService = facturaService;
    }

    // ============================================
    //             GENERAR FACTURA
    // ============================================
    @PostMapping
    public ResponseEntity<?> generar(@RequestBody FacturaDTO dto) {
        try {
            FacturaDTO respuesta = facturaService.generarFactura(dto);
            return ResponseEntity.ok(respuesta);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================
    //        OBTENER FACTURA POR ID
    // ============================================
    @GetMapping("/{id}")
    public ResponseEntity<?> obtener(@PathVariable int id) {
        try {
            return ResponseEntity.ok(facturaService.obtenerFacturaPorId(id));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================
    //         LISTAR TODAS
    // ============================================
    @GetMapping
    public ResponseEntity<?> listar() {
        return ResponseEntity.ok(facturaService.listarTodas());
    }

    // ============================================
    //   LISTAR PENDIENTES POR HABITACIÃ“N
    // ============================================
    @GetMapping("/pendientes/{numeroHabitacion}")
    public ResponseEntity<?> listarPendientesPorHabitacion(@PathVariable int numeroHabitacion) {
        try {
            return ResponseEntity.ok(facturaService.obtenerPendientesPorHabitacion(numeroHabitacion));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================
    //               ACTUALIZAR FACTURA
    // ============================================
    @PutMapping
    public ResponseEntity<?> actualizar(@RequestBody FacturaDTO dto) {
        try {
            return ResponseEntity.ok(facturaService.actualizarFactura(dto));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================
    //             NOTA DE CRÃ‰DITO
    // ============================================
    @PostMapping("/notaDeCredito")
    public ResponseEntity<?> crearNota(@RequestBody NotaDeCreditoDTO dto) {
        try {
            return ResponseEntity.ok(facturaService.crearNotaDeCredito(dto));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================
    //      PAGOS ENTRE FECHAS
    // ============================================
    @GetMapping("/pagos")
    public ResponseEntity<?> buscarPagosEntreFechas(
            @RequestParam String desde,
            @RequestParam String hasta
    ) {
        try {
            LocalDate fDesde = LocalDate.parse(desde);
            LocalDate fHasta = LocalDate.parse(hasta);

            return ResponseEntity.ok(
                    facturaService.buscarPagoesEntreFechas(fDesde, fHasta)
            );

        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================
    //      CHEQUES ENTRE FECHAS
    // ============================================
    @GetMapping("/cheques")
    public ResponseEntity<?> buscarChequesEntreFechas(
            @RequestParam String desde,
            @RequestParam String hasta
    ) {
        try {
            LocalDate fDesde = LocalDate.parse(desde);
            LocalDate fHasta = LocalDate.parse(hasta);

            return ResponseEntity.ok(
                    facturaService.buscarChequesEntreFechas(fDesde, fHasta)
            );

        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/Controller/HuespedController.java]
// [src/main/java/com/hotel/hotel_backend/Controller/HuespedController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dto.HuespedDTO;
import com.hotel.hotel_backend.service.HuespedService;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/huespedes")
public class HuespedController {

    private final HuespedService service;

    public HuespedController(HuespedService service) {
        this.service = service;
    }

    // CREAR
    @PostMapping
    public ResponseEntity<?> crear(@RequestBody HuespedDTO dto) {
        try {
            return ResponseEntity.ok(service.crearHuesped(dto));

        } catch (RuntimeException e) {

            if (e.getMessage().equals("CUIT_DUPLICADO")) {
                return ResponseEntity.status(409).body("CUIT_DUPLICADO");
            }

            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }


    // MODIFICAR
    @PutMapping
    public ResponseEntity<?> modificar(@RequestBody HuespedDTO dto) {
        try {
            return ResponseEntity.ok(service.modificarHuesped(dto));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // BUSCAR POR DOCUMENTO
    @GetMapping("/{documento}")
    public ResponseEntity<?> buscarPorDocumento(@PathVariable String documento) {
        try {
            return ResponseEntity.ok(service.buscarPorDocumento(documento));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // FILTROS
    @GetMapping("/buscar")
    public ResponseEntity<?> buscarConFiltros(
            @RequestParam(required = false) String apellido,
            @RequestParam(required = false) String nombre,
            @RequestParam(required = false) String tipoDocumento,
            @RequestParam(required = false) String numeroDocumento) {

        return ResponseEntity.ok(
                service.buscarConFiltros(apellido, nombre, tipoDocumento, numeroDocumento)
        );
    }

    // LISTAR TODOS
    @GetMapping
    public ResponseEntity<?> listarTodos() {
        return ResponseEntity.ok(service.listarTodos());
    }

    // ELIMINAR
    @DeleteMapping("/{documento}")
    public ResponseEntity<?> eliminar(@PathVariable String documento) {
        try {
            service.eliminarHuesped(documento);
            return ResponseEntity.ok("HuÃ©sped eliminado correctamente.");
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/Controller/ReservaController.java]
// [src/main/java/com/hotel/hotel_backend/Controller/ReservaController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dto.ReservaDTO;
import com.hotel.hotel_backend.service.ReservaService;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/reservas")
public class ReservaController {

    private final ReservaService reservaService;

    public ReservaController(ReservaService reservaService) {
        this.reservaService = reservaService;
    }

    // CREAR RESERVA
    @PostMapping
    public ResponseEntity<?> crear(@RequestBody ReservaDTO dto) {

        try {
            ReservaDTO respuesta = reservaService.reservarHabitacion(dto);
            return ResponseEntity.ok(respuesta);

        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // LISTAR ENTRE FECHAS
    @GetMapping("/entre")
    public ResponseEntity<?> listarEntre(@RequestParam String inicio, @RequestParam String fin) {
        try {
            List<ReservaDTO> lista = reservaService.listarReservasEntre(inicio, fin);
            return ResponseEntity.ok(lista);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // CANCELAR
    @PutMapping("/cancelar")
    public ResponseEntity<?> cancelar(@RequestBody ReservaDTO dto) {
        try {
            ReservaDTO respuesta = reservaService.cancelarReserva(dto);
            return ResponseEntity.ok(respuesta);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/Controller/UsuarioController.java]
package com.hotel.hotel_backend.Controller;

import com.hotel.hotel_backend.dto.UsuarioDTO;
import com.hotel.hotel_backend.service.UsuarioService;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/usuarios")
public class UsuarioController {

    private final UsuarioService usuarioService;

    public UsuarioController(UsuarioService usuarioService) {
        this.usuarioService = usuarioService;
    }

    // ============================================================
    //                AUTENTICAR USUARIO (LOGIN)
    // ============================================================
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody UsuarioDTO dto) {
        try {
            return ResponseEntity.ok(
                    usuarioService.autenticar(dto.getUsername(), dto.getPassword())
            );
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // ============================================================
    //                CREAR USUARIO (opcional)
    // ============================================================
    @PostMapping
    public ResponseEntity<?> crear(@RequestBody UsuarioDTO dto) {
        try {
            return ResponseEntity.ok(usuarioService.crearUsuario(dto));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}



// [src/main/java/com/hotel/hotel_backend/dao/EstadiaDAO.java]
// src/main/java/com/hotel/hotel_backend/dao/EstadiaDAO.java
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Estadia;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.util.Optional;

@Repository
public interface EstadiaDAO extends JpaRepository<Estadia, Integer> {

    @Query("""
            SELECT e FROM Estadia e
            JOIN e.reserva r
            JOIN r.habitaciones h
            WHERE e.estado = 'EnCurso'
              AND h.numero = :numeroHabitacion
           """)
    Optional<Estadia> findActivaByHabitacion(@Param("numeroHabitacion") Integer numeroHabitacion);

    // âœ… Ahora el parÃ¡metro del mÃ©todo estÃ¡ anotado con @Param
    @Query("""
            SELECT CASE WHEN COUNT(e) > 0 THEN TRUE ELSE FALSE END
            FROM Estadia e
            WHERE e.reserva.id = :idReserva
            """)
    boolean existsByReservaId(@Param("idReserva") Integer idReserva);
}



// [src/main/java/com/hotel/hotel_backend/dao/FacturaDAO.java]
// [src/main/java/com/hotel/hotel_backend/dao/FacturaDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Factura;
import com.hotel.hotel_backend.domain.Pago;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.time.LocalDate;
import java.util.List;

public interface FacturaDAO extends JpaRepository<Factura, Integer> {

    // ==================================================
    // FACTURAS PENDIENTES POR HABITACIÃ“N
    // ==================================================
    @Query("""
            SELECT f
            FROM Factura f
            JOIN f.estadia e
            JOIN e.reserva r
            JOIN r.habitaciones h
            WHERE f.estado = 'Pendiente'
              AND h.numero = :nro
            """)
    List<Factura> findPendientesByHabitacion(@Param("nro") int nroHabitacion);


    // ==================================================
    // PAGOS ENTRE FECHAS
    // ==================================================
    @Query("""
            SELECT p
            FROM Factura f
            JOIN f.pagos p
            WHERE p.fecha BETWEEN :desde AND :hasta
            """)
    List<Pago> findPagosEntreFechas(
            @Param("desde") LocalDate desde,
            @Param("hasta") LocalDate hasta
    );


    // ==================================================
    // CHEQUES ENTRE FECHAS
    // ==================================================
    @Query("""
            SELECT p
            FROM Factura f
            JOIN f.pagos p
            WHERE TYPE(p.medioDePago) = Cheque
              AND p.fecha BETWEEN :desde AND :hasta
            """)
    List<Pago> findChequesEntreFechas(
            @Param("desde") LocalDate desde,
            @Param("hasta") LocalDate hasta
    );
}



// [src/main/java/com/hotel/hotel_backend/dao/HabitacionDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Habitacion;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface HabitacionDAO extends JpaRepository<Habitacion, Integer> {

    Optional<Habitacion> findByNumero(Integer numero);
}



// [src/main/java/com/hotel/hotel_backend/dao/HuespedDAO.java]
// [src/main/java/com/hotel/hotel_backend/dao/HuespedDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Huesped;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.Optional;
import java.util.List;

@Repository
public interface HuespedDAO extends JpaRepository<Huesped, String> {

    // Buscar por documento (ID principal)
    Optional<Huesped> findByNumeroDocumento(String numeroDocumento);

    // Para validar existencia desde el service
    boolean existsByNumeroDocumento(String numeroDocumento);

    // Por CUIT (opcional)
    Optional<Huesped> findByCuit(String cuit);

    // BÃºsqueda con filtros
    @Query("""
            SELECT h FROM Huesped h
            WHERE (:apellido IS NULL OR :apellido = '' OR h.apellido LIKE :apellido% )
            AND   (:nombre IS NULL OR :nombre = '' OR h.nombre LIKE :nombre% )
            AND   (:tipoDocumento IS NULL OR :tipoDocumento = '' OR h.tipoDocumento = :tipoDocumento )
            AND   (:numeroDocumento IS NULL OR :numeroDocumento = '' OR h.numeroDocumento LIKE :numeroDocumento% )
           """)
    List<Huesped> buscarConFiltros(
            @Param("apellido") String apellido,
            @Param("nombre") String nombre,
            @Param("tipoDocumento") String tipoDocumento,
            @Param("numeroDocumento") String numeroDocumento
    );

    List<Huesped> findAllByCuit(String cuit);

}



// [src/main/java/com/hotel/hotel_backend/dao/NotaDeCreditoDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.NotaDeCredito;
import org.springframework.data.jpa.repository.JpaRepository;

public interface NotaDeCreditoDAO extends JpaRepository<NotaDeCredito, Integer> {
}



// [src/main/java/com/hotel/hotel_backend/dao/ReservaDAO.java]
// [src/main/java/com/hotel/hotel_backend/dao/ReservaDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Reserva;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.time.LocalDate;
import java.util.List;

@Repository
public interface ReservaDAO extends JpaRepository<Reserva, Integer> {

    // Solapamiento
    @Query("""
            SELECT COUNT(r) > 0
            FROM Reserva r
            JOIN r.habitaciones h
            WHERE h.numero = :nro
              AND r.estado <> 'Cancelada'
              AND r.fechaInicio <= :fin
              AND r.fechaFin >= :inicio
            """)
    boolean existeSolapamiento(
            @Param("nro") Integer nro,
            @Param("inicio") LocalDate inicio,
            @Param("fin") LocalDate fin
    );

    // NUEVO: reservas dentro del rango
    @Query("""
            SELECT r
            FROM Reserva r
            WHERE r.fechaInicio >= :inicio
            AND   r.fechaFin   <= :fin
           """)
    List<Reserva> buscarEntreFechas(
            @Param("inicio") LocalDate inicio,
            @Param("fin") LocalDate fin
    );
}



// [src/main/java/com/hotel/hotel_backend/dao/UsuarioDAO.java]
package com.hotel.hotel_backend.dao;

import com.hotel.hotel_backend.domain.Usuario;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface UsuarioDAO extends JpaRepository<Usuario, Integer> {

    Optional<Usuario> findByUsername(String username);
}



// [src/main/java/com/hotel/hotel_backend/domain/Direccion.java]
package com.hotel.hotel_backend.domain;

import com.hotel.hotel_backend.dto.DireccionDTO;

import jakarta.persistence.Embeddable;

@Embeddable
public class Direccion {
    private String calle;
    private String numero;
    private String departamento;
    private String piso;
    private String codigoPostal;
    private String localidad;
    private String provincia;
    private String pais;

    public Direccion() {}

    public Direccion(String calle, String numero, String departamento, String piso,
                     String codigoPostal, String localidad, String provincia, String pais) {
        this.calle = calle;
        this.numero = numero;
        this.departamento = departamento;
        this.piso = piso;
        this.codigoPostal = codigoPostal;
        this.localidad = localidad;
        this.provincia = provincia;
        this.pais = pais;
    }

    // Getters y setters
    public String getCalle() { return calle; }
    public void setCalle(String calle) { this.calle = calle; }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getDepartamento() { return departamento; }
    public void setDepartamento(String departamento) { this.departamento = departamento; }

    public String getPiso() { return piso; }
    public void setPiso(String piso) { this.piso = piso; }

    public String getCodigoPostal() { return codigoPostal; }
    public void setCodigoPostal(String codigoPostal) { this.codigoPostal = codigoPostal; }

    public String getLocalidad() { return localidad; }
    public void setLocalidad(String localidad) { this.localidad = localidad; }

    public String getProvincia() { return provincia; }
    public void setProvincia(String provincia) { this.provincia = provincia; }

    public String getPais() { return pais; }
    public void setPais(String pais) { this.pais = pais; }

    public static DireccionDTO mapearDireccionADTO(Direccion direccion) {
        return new DireccionDTO(direccion.getCalle(), direccion.getNumero(), 
                                direccion.getDepartamento(), direccion.getPiso(), 
                                direccion.getCodigoPostal(), direccion.getLocalidad(), 
                                direccion.getProvincia(), direccion.getPais());
    }

    public static Direccion mapearDireccionDominio(DireccionDTO dto) {
        if (dto == null) return null;
        return new Direccion(
            dto.getCalle(),
            dto.getNumero(),
            dto.getDepartamento(),
            dto.getPiso(),
            dto.getCodigoPostal(),
            dto.getLocalidad(),
            dto.getProvincia(),
            dto.getPais()
        );
    }
}


// [src/main/java/com/hotel/hotel_backend/domain/Estadia.java]
// src/main/java/com/hotel/hotel_backend/domain/Estadia.java
package com.hotel.hotel_backend.domain;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.List;

import jakarta.persistence.*;

@Entity
@Table(name = "estadia")
public class Estadia {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "estadia_id")
    private Integer id;

    @Column(name = "fecha_inicio", nullable = false)
    private LocalDate fechaCheckIn;

    @Column(name = "hora_inicio")
    private LocalTime horaCheckIn;

    // âœ… Ahora permiten NULL hasta el check-out
    @Column(name = "fecha_fin")
    private LocalDate fechaCheckOut;

    @Column(name = "hora_fin")
    private LocalTime horaCheckOut;

    @Column(nullable = false)
    private String estado;

    @ManyToOne
    @JoinColumn(name = "reserva_id", nullable = false)
    private Reserva reserva;

    @ManyToOne
    @JoinColumn(name = "titular_documento")
    private Huesped titular;

    @ManyToMany
    @JoinTable(
            name = "estadia_acompaniantes",
            joinColumns = @JoinColumn(name = "estadia_id"),
            inverseJoinColumns = @JoinColumn(name = "acompaniante_documento")
    )
    private List<Huesped> acompaniantes;

    public Estadia() {}

    public Estadia(Integer id,
                   LocalDate fechaCheckIn,
                   LocalTime horaCheckIn,
                   LocalDate fechaCheckOut,
                   LocalTime horaCheckOut,
                   String estado,
                   Reserva reserva,
                   Huesped titular,
                   List<Huesped> acompaniantes
    ) {
        this.id = id;
        this.fechaCheckIn = fechaCheckIn;
        this.horaCheckIn = horaCheckIn;
        this.fechaCheckOut = fechaCheckOut;
        this.horaCheckOut = horaCheckOut;
        this.estado = estado;
        this.reserva = reserva;
        this.titular = titular;
        this.acompaniantes = acompaniantes;
    }

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public LocalDate getFechaCheckIn() { return fechaCheckIn; }
    public void setFechaCheckIn(LocalDate fechaCheckIn) { this.fechaCheckIn = fechaCheckIn; }

    public LocalTime getHoraCheckIn() { return horaCheckIn; }
    public void setHoraCheckIn(LocalTime horaCheckIn) { this.horaCheckIn = horaCheckIn; }

    public LocalDate getFechaCheckOut() { return fechaCheckOut; }
    public void setFechaCheckOut(LocalDate fechaCheckOut) { this.fechaCheckOut = fechaCheckOut; }

    public LocalTime getHoraCheckOut() { return horaCheckOut; }
    public void setHoraCheckOut(LocalTime horaCheckOut) { this.horaCheckOut = horaCheckOut; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public Reserva getReserva() { return reserva; }
    public void setReserva(Reserva reserva) { this.reserva = reserva; }

    public Huesped getTitular() { return titular; }
    public void setTitular(Huesped titular) { this.titular = titular; }

    public List<Huesped> getAcompaniantes() { return acompaniantes; }
    public void setAcompaniantes(List<Huesped> acompaniantes) { this.acompaniantes = acompaniantes; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Factura.java]
// [src/main/java/com/hotel/hotel_backend/domain/Factura.java]
package com.hotel.hotel_backend.domain;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.List;

import com.hotel.hotel_backend.domain.ResponsableDePago.ResponsableDePago;
import com.hotel.hotel_backend.domain.MedioDePago.MedioDePago;

import jakarta.persistence.*;

@Entity
@Table(name = "factura")
public class Factura {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "factura_id")
    private Integer id;

    @Column(nullable = false)
    private LocalTime hora;

    @Column(nullable = false)
    private LocalDate fecha;

    private String tipo;
    private String estado;

    // ============================
    //   RESPONSABLE DE PAGO (SIN CASCADE)
    // ============================
    @ManyToOne
    @JoinColumn(name = "responsable_de_pago_id")
    private ResponsableDePago responsableDePago;

    // ============================
    //   MEDIO DE PAGO (SIN CASCADE)
    // ============================
    @ManyToOne
    @JoinColumn(name = "medio_de_pago_id")
    private MedioDePago medioDePago;

    // ============================
    //   ESTADÃA (SIN CASCADE)
    // ============================
    @ManyToOne
    @JoinColumn(name = "estadia_id")
    private Estadia estadia;

    // ============================
    //   PAGOS (cascade ALL)
    // ============================
    @OneToMany(mappedBy = "factura", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Pago> pagos;

    private double total;
    private double iva;
    private String detalle;

    @Column(name = "hora_salida")
    private LocalTime horaSalida;

    // ============================
    //       CONSTRUCTORES
    // ============================
    public Factura() {}

    public Factura(Integer id,
                   LocalTime hora,
                   LocalDate fecha,
                   String tipo,
                   String estado,
                   ResponsableDePago responsableDePago,
                   MedioDePago medioDePago,
                   Estadia estadia,
                   List<Pago> pagos,
                   double total,
                   double iva,
                   String detalle,
                   LocalTime horaSalida) {

        this.id = id;
        this.hora = hora;
        this.fecha = fecha;
        this.tipo = tipo;
        this.estado = estado;
        this.responsableDePago = responsableDePago;
        this.medioDePago = medioDePago;
        this.estadia = estadia;
        this.pagos = pagos;
        this.total = total;
        this.iva = iva;
        this.detalle = detalle;
        this.horaSalida = horaSalida;

        if (pagos != null) {
            pagos.forEach(p -> p.setFactura(this));
        }
    }

    // ============================
    //        GETTERS / SETTERS
    // ============================

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public LocalTime getHora() { return hora; }
    public void setHora(LocalTime hora) { this.hora = hora; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public ResponsableDePago getResponsableDePago() { return responsableDePago; }
    public void setResponsableDePago(ResponsableDePago responsableDePago) { this.responsableDePago = responsableDePago; }

    public MedioDePago getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePago medioDePago) { this.medioDePago = medioDePago; }

    public Estadia getEstadia() { return estadia; }
    public void setEstadia(Estadia estadia) { this.estadia = estadia; }

    public List<Pago> getPagos() { return pagos; }
    public void setPagos(List<Pago> pagos) {
        this.pagos = pagos;
        if (pagos != null) {
            pagos.forEach(p -> p.setFactura(this));
        }
    }

    public double getTotal() { return total; }
    public void setTotal(double total) { this.total = total; }

    public double getIva() { return iva; }
    public void setIva(double iva) { this.iva = iva; }

    public String getDetalle() { return detalle; }
    public void setDetalle(String detalle) { this.detalle = detalle; }

    public LocalTime getHoraSalida() { return horaSalida; }
    public void setHoraSalida(LocalTime horaSalida) { this.horaSalida = horaSalida; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Habitacion.java]
package com.hotel.hotel_backend.domain;

import jakarta.persistence.*;

@Entity
@Table(name = "habitacion")
public class Habitacion {

    @Id
    @Column(name = "numero_habitacion")
    private Integer numero;

    private String tipo;      // INDIVIDUAL, DOBLE, SUPERIOR, etc.
    private String categoria; // Estandar, Superior, Family, Suite

    @Column(name = "costo_por_noche")
    private double costoPorNoche;

    private String estado; 
    // Disponible - Reservada - Ocupada - FueraDeServicio

    public Habitacion() {}

    public Habitacion(Integer numero, String tipo, String categoria, double costoPorNoche, String estado) {
        this.numero = numero;
        this.tipo = tipo;
        this.categoria = categoria;
        this.costoPorNoche = costoPorNoche;
        this.estado = estado;
    }

    public Integer getNumero() { return numero; }
    public void setNumero(Integer numero) { this.numero = numero; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getCategoria() { return categoria; }
    public void setCategoria(String categoria) { this.categoria = categoria; }

    public double getCostoPorNoche() { return costoPorNoche; }
    public void setCostoPorNoche(double costoPorNoche) { this.costoPorNoche = costoPorNoche; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Huesped.java]
package com.hotel.hotel_backend.domain;

import jakarta.persistence.*;

@Entity
@Table(name = "huesped")
public class Huesped {
    
    @Id
    @Column(name = "numero_documento")
    private String numeroDocumento;
    private String apellido;
    private String nombre;
    private String tipoDocumento;
    private String cuit;
    @Embedded
    private Direccion direccion;  // ComposiciÃ³n
    private String email;
    private String ocupacion;
    private String nacionalidad;
    public Huesped() {
    }

    public Huesped(String apellido, String nombre, String tipoDocumento, String numeroDocumento,
                   String cuit, Direccion direccion,
                   String email, String ocupacion, String nacionalidad) {
        this.apellido = apellido;
        this.nombre = nombre;
        this.tipoDocumento = tipoDocumento;
        this.numeroDocumento = numeroDocumento;
        this.cuit = cuit;
        this.direccion = direccion;
        this.email = email;
        this.ocupacion = ocupacion;
        this.nacionalidad = nacionalidad;
    }

    // ======== Getters y Setters ========

    public String getApellido() {
        return apellido;
    }

    public void setApellido(String apellido) {
        this.apellido = apellido;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    public String getTipoDocumento() {
        return tipoDocumento;
    }

    public void setTipoDocumento(String tipoDocumento) {
        this.tipoDocumento = tipoDocumento;
    }

    public String getNumeroDocumento() {
        return numeroDocumento;
    }

    public void setNumeroDocumento(String numeroDocumento) {
        this.numeroDocumento = numeroDocumento;
    }

    public String getCuit() {
        return cuit;
    }

    public void setCuit(String cuit) {
        this.cuit = cuit;
    }


    public Direccion getDireccion() {
        return direccion;
    }

    public void setDireccion(Direccion direccion) {
        this.direccion = direccion;
    }


    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getOcupacion() {
        return ocupacion;
    }

    public void setOcupacion(String ocupacion) {
        this.ocupacion = ocupacion;
    }

    public String getNacionalidad() {
        return nacionalidad;
    }

    public void setNacionalidad(String nacionalidad) {
        this.nacionalidad = nacionalidad;
    }
    

}


// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/Cheque.java]
package com.hotel.hotel_backend.domain.MedioDePago;

import jakarta.persistence.DiscriminatorValue;
import jakarta.persistence.Entity;

@Entity
@DiscriminatorValue("cheque")
public class Cheque extends MedioDePago {

    private String numero;
    private String fechaVencimiento;

    public Cheque() {}

    public Cheque(String numero, double monto, String fechaVencimiento) {
        super(monto);
        this.numero = numero;
        this.fechaVencimiento = fechaVencimiento;
    }

    @Override
    public String getTipo() {
        return "cheque";
    }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getFechaVencimiento() { return fechaVencimiento; }
    public void setFechaVencimiento(String fechaVencimiento) { this.fechaVencimiento = fechaVencimiento; }
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/Efectivo.java]
package com.hotel.hotel_backend.domain.MedioDePago;

import jakarta.persistence.DiscriminatorValue;
import jakarta.persistence.Entity;

@Entity
@DiscriminatorValue("efectivo")
public class Efectivo extends MedioDePago {

    public Efectivo() {}

    public Efectivo(double monto) {
        super(monto);
    }

    @Override
    public String getTipo() {
        return "efectivo";
    }
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/MedioDePago.java]
// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/MedioDePago.java]
package com.hotel.hotel_backend.domain.MedioDePago;

import jakarta.persistence.*;

@Entity
@Table(name = "medio_de_pago")
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "tipo", discriminatorType = DiscriminatorType.STRING)
public abstract class MedioDePago {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "medio_pago_id")
    private Integer id;

    private double monto;

    public MedioDePago() {}

    public MedioDePago(double monto) {
        this.monto = monto;
    }

    public Integer getId() { return id; }

    public double getMonto() { return monto; }
    public void setMonto(double monto) { this.monto = monto; }

    public abstract String getTipo();
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/MonedaExtranjera.java]
package com.hotel.hotel_backend.domain.MedioDePago;

import jakarta.persistence.DiscriminatorValue;
import jakarta.persistence.Entity;

@Entity
@DiscriminatorValue("monedaExtranjera")
public class MonedaExtranjera extends MedioDePago {

    private String tipoMoneda;
    private double montoExtranjero;
    private double cotizacion;

    public MonedaExtranjera() {}

    public MonedaExtranjera(String tipoMoneda, double montoExtranjero,
                            double cotizacion, double monto) {
        super(monto);
        this.tipoMoneda = tipoMoneda;
        this.montoExtranjero = montoExtranjero;
        this.cotizacion = cotizacion;
    }

    @Override
    public String getTipo() {
        return "monedaExtranjera";
    }

    public String getTipoMoneda() { return tipoMoneda; }
    public void setTipoMoneda(String tipoMoneda) { this.tipoMoneda = tipoMoneda; }

    public double getMontoExtranjero() { return montoExtranjero; }
    public void setMontoExtranjero(double montoExtranjero) { this.montoExtranjero = montoExtranjero; }

    public double getCotizacion() { return cotizacion; }
    public void setCotizacion(double cotizacion) { this.cotizacion = cotizacion; }
}



// [src/main/java/com/hotel/hotel_backend/domain/MedioDePago/Tarjeta.java]
package com.hotel.hotel_backend.domain.MedioDePago;

import jakarta.persistence.DiscriminatorValue;
import jakarta.persistence.Entity;

@Entity
@DiscriminatorValue("tarjeta")
public class Tarjeta extends MedioDePago {

    private String tipoTarjeta;
    private String numeroTarjeta;

    public Tarjeta() {}

    public Tarjeta(String tipoTarjeta, String numeroTarjeta, double monto) {
        super(monto);
        this.tipoTarjeta = tipoTarjeta;
        this.numeroTarjeta = numeroTarjeta;
    }

    @Override
    public String getTipo() {
        return "tarjeta";
    }

    public String getTipoTarjeta() { return tipoTarjeta; }
    public void setTipoTarjeta(String tipoTarjeta) { this.tipoTarjeta = tipoTarjeta; }

    public String getNumeroTarjeta() { return numeroTarjeta; }
    public void setNumeroTarjeta(String numeroTarjeta) { this.numeroTarjeta = numeroTarjeta; }
}



// [src/main/java/com/hotel/hotel_backend/domain/NotaDeCredito.java]
package com.hotel.hotel_backend.domain;

import com.hotel.hotel_backend.domain.ResponsableDePago.ResponsableDePago;

import jakarta.persistence.*;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "nota_de_credito")
public class NotaDeCredito {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id_nota")
    private Integer idNota;

    @Column(name = "fecha", nullable = false)
    private LocalDate fecha;

    @ManyToOne
    @JoinColumn(name = "responsable_de_pago_id")
    private ResponsableDePago responsable;

    @ManyToMany
    @JoinTable(
        name = "nota_factura",
        joinColumns = @JoinColumn(name = "nota_id"),
        inverseJoinColumns = @JoinColumn(name = "factura_id")
    )
    private List<Factura> facturas = new ArrayList<>();

    private String tipo;

    public NotaDeCredito() {
        // Constructor vacÃ­o necesario para JPA
    }

    public NotaDeCredito(Integer idNota, LocalDate fecha,
                         ResponsableDePago responsable,
                         List<Factura> facturas,
                         String tipo) {

        this.idNota = idNota;
        this.fecha = fecha != null ? fecha : LocalDate.now();
        this.responsable = responsable;
        this.facturas = facturas != null ? facturas : new ArrayList<>();
        this.tipo = tipo;
    }

    public Integer getIdNota() { return idNota; }
    public void setIdNota(Integer idNota) { this.idNota = idNota; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public ResponsableDePago getResponsable() { return responsable; }
    public void setResponsable(ResponsableDePago responsable) { this.responsable = responsable; }

    public List<Factura> getFacturas() { return facturas; }
    public void setFacturas(List<Factura> facturas) { this.facturas = facturas; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Pago.java]
// [src/main/java/com/hotel/hotel_backend/domain/Pago.java]
package com.hotel.hotel_backend.domain;

import com.hotel.hotel_backend.domain.MedioDePago.MedioDePago;
import jakarta.persistence.*;

import java.time.LocalDate;
import java.time.LocalTime;

@Entity
@Table(name = "pago")
public class Pago {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "pago_id")
    private Integer id;

    @Column(name = "fecha", nullable = false)
    private LocalDate fecha;

    @Column(name = "hora", nullable = false)
    private LocalTime hora;

    @Column(name = "monto_total")
    private double montoTotal;

    // ===========================================
    //        MEDIO DE PAGO  (SIN CASCADE)
    // ===========================================
    @ManyToOne
    @JoinColumn(name = "medio_pago_id")
    private MedioDePago medioDePago;

    // ===========================================
    //                FACTURA  (SIN CASCADE)
    // ===========================================
    @ManyToOne
    @JoinColumn(name = "factura_id")
    private Factura factura;

    public Pago() {}

    public Pago(Integer id, LocalDate fecha, LocalTime hora,
                double montoTotal, MedioDePago medioDePago) {
        this.id = id;
        this.fecha = fecha;
        this.hora = hora;
        this.montoTotal = montoTotal;
        this.medioDePago = medioDePago;
    }

    // ===========================
    //     GETTERS / SETTERS
    // ===========================

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public LocalTime getHora() { return hora; }
    public void setHora(LocalTime hora) { this.hora = hora; }

    public double getMontoTotal() { return montoTotal; }
    public void setMontoTotal(double montoTotal) { this.montoTotal = montoTotal; }

    public MedioDePago getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePago medioDePago) { this.medioDePago = medioDePago; }

    public Factura getFactura() { return factura; }
    public void setFactura(Factura factura) { this.factura = factura; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Persona.java]
package com.hotel.hotel_backend.domain;

import jakarta.persistence.Embeddable;

@Embeddable
public class Persona {

    private String nombre;
    private String apellido;
    private String telefono;

    public Persona() {}

    public Persona(String nombre, String apellido, String telefono) {
        this.nombre = nombre;
        this.apellido = apellido;
        this.telefono = telefono;
    }

    public String getNombre() { return nombre; }
    public void setNombre(String nombre) { this.nombre = nombre; }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getTelefono() { return telefono; }
    public void setTelefono(String telefono) { this.telefono = telefono; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Reserva.java]
package com.hotel.hotel_backend.domain;

import jakarta.persistence.*;
import java.time.LocalDate;
import java.util.List;

@Entity
@Table(name = "reserva")
public class Reserva {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "reserva_id")
    private Integer id;

    @Column(name = "fecha_inicio", nullable = false)
    private LocalDate fechaInicio;

    @Column(name = "fecha_fin", nullable = false)
    private LocalDate fechaFin;

    // ========= TITULAR (Persona embebida) =========
    @Embedded
    @AttributeOverrides({
            @AttributeOverride(name = "nombre", column = @Column(name = "titular_nombre")),
            @AttributeOverride(name = "apellido", column = @Column(name = "titular_apellido")),
            @AttributeOverride(name = "telefono", column = @Column(name = "titular_telefono"))
    })
    private Persona titular;

    // ========= HABITACIONES =========
    @ManyToMany
    @JoinTable(
            name = "reserva_habitacion",
            joinColumns = @JoinColumn(name = "reserva_id"),
            inverseJoinColumns = @JoinColumn(name = "habitacion_numero")
    )
    private List<Habitacion> habitaciones;

    @Column(nullable = false)
    private String estado; // Pendiente - Confirmada - Reservada - Cancelada

    public Reserva() {}

    public Reserva(Integer id, LocalDate fechaInicio, LocalDate fechaFin,
                   Persona titular, List<Habitacion> habitaciones, String estado) {
        this.id = id;
        this.fechaInicio = fechaInicio;
        this.fechaFin = fechaFin;
        this.titular = titular;
        this.habitaciones = habitaciones;
        this.estado = estado;
    }

    // ========= GETTERS / SETTERS =========

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public LocalDate getFechaInicio() { return fechaInicio; }
    public void setFechaInicio(LocalDate fechaInicio) { this.fechaInicio = fechaInicio; }

    public LocalDate getFechaFin() { return fechaFin; }
    public void setFechaFin(LocalDate fechaFin) { this.fechaFin = fechaFin; }

    public Persona getTitular() { return titular; }
    public void setTitular(Persona titular) { this.titular = titular; }

    public List<Habitacion> getHabitaciones() { return habitaciones; }
    public void setHabitaciones(List<Habitacion> habitaciones) { this.habitaciones = habitaciones; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }
}



// [src/main/java/com/hotel/hotel_backend/domain/ResponsableDePago/ResponsableDePago.java]
package com.hotel.hotel_backend.domain.ResponsableDePago;

import jakarta.persistence.*;

@Entity
@Table(name = "responsable_pago")
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "tipo", discriminatorType = DiscriminatorType.STRING)
public abstract class ResponsableDePago {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "responsable_id")
    private Integer id;

    @Column(insertable = false, updatable = false)
    private String tipo;

    public ResponsableDePago() {}  // â† NECESARIO PARA JPA

    public Integer getId() { return id; }

    public String getTipo() { return tipo; }
}



// [src/main/java/com/hotel/hotel_backend/domain/ResponsableDePago/ResponsableHuesped.java]
package com.hotel.hotel_backend.domain.ResponsableDePago;

import jakarta.persistence.*;

@Entity
@DiscriminatorValue("huesped")
public class ResponsableHuesped extends ResponsableDePago {

    @Column(nullable = false)
    private String apellido;

    @Column(nullable = false)
    private String nombres;

    @Column(nullable = false)
    private String documento;

    public ResponsableHuesped() {
        super();
    }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getNombres() { return nombres; }
    public void setNombres(String nombres) { this.nombres = nombres; }

    public String getDocumento() { return documento; }
    public void setDocumento(String documento) { this.documento = documento; }
}



// [src/main/java/com/hotel/hotel_backend/domain/ResponsableDePago/ResponsableJuridico.java]
package com.hotel.hotel_backend.domain.ResponsableDePago;

import jakarta.persistence.*;

@Entity
@DiscriminatorValue("juridica")
public class ResponsableJuridico extends ResponsableDePago {

    @Column(nullable = false)
    private String razonSocial;

    @Column(nullable = false)
    private String cuit;

    public ResponsableJuridico() {
        super();
    }

    public String getRazonSocial() { return razonSocial; }
    public void setRazonSocial(String razonSocial) { this.razonSocial = razonSocial; }

    public String getCuit() { return cuit; }
    public void setCuit(String cuit) { this.cuit = cuit; }
}



// [src/main/java/com/hotel/hotel_backend/domain/Usuario.java]
package com.hotel.hotel_backend.domain;

import jakarta.persistence.*;

@Entity
@Table(name = "usuario")
public class Usuario {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "usuario_id")
    private Integer id;

    @Column(nullable = false, unique = true)
    private String username;

    @Column(nullable = false)
    private String password; // En esta etapa se permite texto plano

    @Column(nullable = false)
    private String rol; // admin, recepcion, gerente, etc.

    public Usuario() {}

    public Usuario(Integer id, String username, String password, String rol) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.rol = rol;
    }

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public String getRol() { return rol; }
    public void setRol(String rol) { this.rol = rol; }
}



// [src/main/java/com/hotel/hotel_backend/dto/ConsumoDTO.java]
package com.hotel.hotel_backend.dto;

public class ConsumoDTO {
    private String descripcion;
    private Double importe;

    public ConsumoDTO() {}

    public String getDescripcion() { return descripcion; }
    public void setDescripcion(String descripcion) { this.descripcion = descripcion; }

    public Double getImporte() { return importe; }
    public void setImporte(Double importe) { this.importe = importe; }
}



// [src/main/java/com/hotel/hotel_backend/dto/DireccionDTO.java]
package com.hotel.hotel_backend.dto;

public class DireccionDTO {
    private String calle;
    private String numero;
    private String departamento;
    private String piso;
    private String codigoPostal;
    private String localidad;
    private String provincia;
    private String pais;

    public DireccionDTO() {}

    public DireccionDTO(String calle, String numero, String departamento, String piso,
                     String codigoPostal, String localidad, String provincia, String pais) {
        this.calle = calle;
        this.numero = numero;
        this.departamento = departamento;
        this.piso = piso;
        this.codigoPostal = codigoPostal;
        this.localidad = localidad;
        this.provincia = provincia;
        this.pais = pais;
    }

    // Getters y setters
    public String getCalle() { return calle; }
    public void setCalle(String calle) { this.calle = calle; }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getDepartamento() { return departamento; }
    public void setDepartamento(String departamento) { this.departamento = departamento; }

    public String getPiso() { return piso; }
    public void setPiso(String piso) { this.piso = piso; }

    public String getCodigoPostal() { return codigoPostal; }
    public void setCodigoPostal(String codigoPostal) { this.codigoPostal = codigoPostal; }

    public String getLocalidad() { return localidad; }
    public void setLocalidad(String localidad) { this.localidad = localidad; }

    public String getProvincia() { return provincia; }
    public void setProvincia(String provincia) { this.provincia = provincia; }

    public String getPais() { return pais; }
    public void setPais(String pais) { this.pais = pais; }

    
}


// [src/main/java/com/hotel/hotel_backend/dto/EstadiaDTO.java]
package com.hotel.hotel_backend.dto;

import java.util.List;

public class EstadiaDTO {

    private Integer id;

    private String fechaCheckIn;
    private String horaCheckIn;

    private String fechaCheckOut;
    private String horaCheckOut;

    private String estado;

    private ReservaDTO reserva;

    private HuespedDTO titular;

    private List<HuespedDTO> acompaniantes;

    public EstadiaDTO() {
    }

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public String getFechaCheckIn() { return fechaCheckIn; }
    public void setFechaCheckIn(String fechaCheckIn) { this.fechaCheckIn = fechaCheckIn; }

    public String getHoraCheckIn() { return horaCheckIn; }
    public void setHoraCheckIn(String horaCheckIn) { this.horaCheckIn = horaCheckIn; }

    public String getFechaCheckOut() { return fechaCheckOut; }
    public void setFechaCheckOut(String fechaCheckOut) { this.fechaCheckOut = fechaCheckOut; }

    public String getHoraCheckOut() { return horaCheckOut; }
    public void setHoraCheckOut(String horaCheckOut) { this.horaCheckOut = horaCheckOut; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public ReservaDTO getReserva() { return reserva; }
    public void setReserva(ReservaDTO reserva) { this.reserva = reserva; }

    public HuespedDTO getTitular() { return titular; }
    public void setTitular(HuespedDTO titular) { this.titular = titular; }

    public List<HuespedDTO> getAcompaniantes() { return acompaniantes; }
    public void setAcompaniantes(List<HuespedDTO> acompaniantes) { this.acompaniantes = acompaniantes; }
}



// [src/main/java/com/hotel/hotel_backend/dto/FacturaDTO.java]
// [src/main/java/com/hotel/hotel_backend/dto/FacturaDTO.java]
package com.hotel.hotel_backend.dto;

import com.hotel.hotel_backend.dto.MedioDePago.MedioDePagoDTO;
import com.hotel.hotel_backend.dto.ResponsableDePago.ResponsableDePagoDTO;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.List;

public class FacturaDTO {

    private int id;
    private LocalTime hora;
    private LocalDate fecha;
    private String tipo;
    private String estado;

    private ResponsableDePagoDTO responsableDePago; 
    private MedioDePagoDTO medioDePago;

    private EstadiaDTO estadia;

    private List<PagoDTO> pagos;
    private double total;
    private double iva;
    private String detalle;
    private LocalTime horaSalida;

    public FacturaDTO() {}

    public FacturaDTO(int id, LocalTime hora, LocalDate fecha, String tipo, String estado,
                      ResponsableDePagoDTO responsableDePago, MedioDePagoDTO medioDePago,
                      EstadiaDTO estadia, List<PagoDTO> pagos,
                      double total, double iva, String detalle, LocalTime horaSalida) {

        this.id = id;
        this.hora = hora;
        this.fecha = fecha;
        this.tipo = tipo;
        this.estado = estado;
        this.responsableDePago = responsableDePago;
        this.medioDePago = medioDePago;
        this.estadia = estadia;
        this.pagos = pagos;
        this.total = total;
        this.iva = iva;
        this.detalle = detalle;
        this.horaSalida = horaSalida;
    }

    // ---------------- Getters & Setters ------------------

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public LocalTime getHora() { return hora; }
    public void setHora(LocalTime hora) { this.hora = hora; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }

    public ResponsableDePagoDTO getResponsableDePago() { return responsableDePago; }
    public void setResponsableDePago(ResponsableDePagoDTO responsableDePago) { this.responsableDePago = responsableDePago; }

    public MedioDePagoDTO getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePagoDTO medioDePago) { this.medioDePago = medioDePago; }

    public EstadiaDTO getEstadia() { return estadia; }
    public void setEstadia(EstadiaDTO estadia) { this.estadia = estadia; }

    public List<PagoDTO> getPagos() { return pagos; }
    public void setPagos(List<PagoDTO> pagos) { this.pagos = pagos; }

    public double getTotal() { return total; }
    public void setTotal(double total) { this.total = total; }

    public double getIva() { return iva; }
    public void setIva(double iva) { this.iva = iva; }

    public String getDetalle() { return detalle; }
    public void setDetalle(String detalle) { this.detalle = detalle; }

    public LocalTime getHoraSalida() { return horaSalida; }
    public void setHoraSalida(LocalTime horaSalida) { this.horaSalida = horaSalida; }
}



// [src/main/java/com/hotel/hotel_backend/dto/HabitacionDTO.java]
package com.hotel.hotel_backend.dto;

public class HabitacionDTO {

    private int numero;
    private String tipo;
    private String categoria;
    private double costoPorNoche;
    private String estado;

    public HabitacionDTO() {}

    public int getNumero() { return numero; }
    public void setNumero(int numero) { this.numero = numero; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }

    public String getCategoria() { return categoria; }
    public void setCategoria(String categoria) { this.categoria = categoria; }

    public double getCostoPorNoche() { return costoPorNoche; }
    public void setCostoPorNoche(double costoPorNoche) { this.costoPorNoche = costoPorNoche; }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }
}



// [src/main/java/com/hotel/hotel_backend/dto/HuespedDTO.java]
// [src/main/java/com/hotel/hotel_backend/dto/HuespedDTO.java]
package com.hotel.hotel_backend.dto;

public class HuespedDTO {
    private String nombre;
    private String apellido;
    private String tipoDocumento;
    private String numeroDocumento;
    private String ocupacion;
    private String nacionalidad;
    private String cuit;
    private String email;

    private DireccionDTO direccion; // puede ser null
    private String condicionIVA;    // puede ser null

    private boolean forzar;
    public boolean isForzar() { return forzar; }
    public void setForzar(boolean forzar) { this.forzar = forzar; }

    public HuespedDTO() {}

    public String getNombre() { return nombre; }
    public void setNombre(String nombre) { this.nombre = nombre; }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getTipoDocumento() { return tipoDocumento; }
    public void setTipoDocumento(String tipoDocumento) { this.tipoDocumento = tipoDocumento; }

    public String getNumeroDocumento() { return numeroDocumento; }
    public void setNumeroDocumento(String numeroDocumento) { this.numeroDocumento = numeroDocumento; }

    public String getOcupacion() { return ocupacion; }
    public void setOcupacion(String ocupacion) { this.ocupacion = ocupacion; }

    public String getNacionalidad() { return nacionalidad; }
    public void setNacionalidad(String nacionalidad) { this.nacionalidad = nacionalidad; }

    public String getCuit() { return cuit; }
    public void setCuit(String cuit) { this.cuit = cuit; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public DireccionDTO getDireccion() { return direccion; }
    public void setDireccion(DireccionDTO direccion) { this.direccion = direccion; }

    public String getCondicionIVA() { return condicionIVA; }
    public void setCondicionIVA(String condicionIVA) { this.condicionIVA = condicionIVA; }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/ChequeDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class ChequeDTO extends MedioDePagoDTO {

    private String numero;
    private String fechaVencimiento;

    public ChequeDTO() {}

    public ChequeDTO(String numero, double monto, String fechaVencimiento) {
        super(monto);
        this.numero = numero;
        this.fechaVencimiento = fechaVencimiento;
    }

    @Override
    public String getTipo() {
        return "Cheque";
    }

    public String getNumero() { return numero; }
    public void setNumero(String numero) { this.numero = numero; }

    public String getFechaVencimiento() { return fechaVencimiento; }
    public void setFechaVencimiento(String fechaVencimiento) { this.fechaVencimiento = fechaVencimiento; }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/EfectivoDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class EfectivoDTO extends MedioDePagoDTO {

    public EfectivoDTO() {}

    public EfectivoDTO(double monto) {
        super(monto);
    }

    @Override
    public String getTipo() {
        return "Efectivo";
    }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/MedioDePagoDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;

@JsonTypeInfo(
        use = JsonTypeInfo.Id.NAME,
        include = JsonTypeInfo.As.PROPERTY,
        property = "tipo"
)
@JsonSubTypes({
        @JsonSubTypes.Type(value = TarjetaDTO.class, name = "tarjeta"),
        @JsonSubTypes.Type(value = ChequeDTO.class, name = "cheque"),
        @JsonSubTypes.Type(value = MonedaExtranjeraDTO.class, name = "monedaExtranjera"),
        @JsonSubTypes.Type(value = EfectivoDTO.class, name = "efectivo")
})

public abstract class MedioDePagoDTO {

    private double monto;

    public MedioDePagoDTO() {}

    public MedioDePagoDTO(double monto) {
        this.monto = monto;
    }

    public double getMonto() { return monto; }
    public void setMonto(double monto) { this.monto = monto; }

    public abstract String getTipo();
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/MonedaExtranjeraDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class MonedaExtranjeraDTO extends MedioDePagoDTO {

    private String tipoMoneda;
    private double montoExtranjero;
    private double cotizacion;

    public MonedaExtranjeraDTO() {}

    public MonedaExtranjeraDTO(String tipoMoneda, double montoExtranjero,
                            double cotizacion, double monto) {
        super(monto);
        this.tipoMoneda = tipoMoneda;
        this.montoExtranjero = montoExtranjero;
        this.cotizacion = cotizacion;
    }

    @Override
    public String getTipo() {
        return "MonedaExtranjera";
    }

    public String getTipoMoneda() { return tipoMoneda; }
    public void setTipoMoneda(String tipoMoneda) { this.tipoMoneda = tipoMoneda; }

    public double getMontoExtranjero() { return montoExtranjero; }
    public void setMontoExtranjero(double montoExtranjero) { this.montoExtranjero = montoExtranjero; }

    public double getCotizacion() { return cotizacion; }
    public void setCotizacion(double cotizacion) { this.cotizacion = cotizacion; }
}



// [src/main/java/com/hotel/hotel_backend/dto/MedioDePago/TarjetaDTO.java]
package com.hotel.hotel_backend.dto.MedioDePago;

public class TarjetaDTO extends MedioDePagoDTO {

    private String tipoTarjeta;     
    private String numeroTarjeta;

    public TarjetaDTO() {}

    public TarjetaDTO(String tipoTarjeta, String numeroTarjeta, double monto) {
        super(monto);
        this.tipoTarjeta = tipoTarjeta;
        this.numeroTarjeta = numeroTarjeta;
    }

    @Override
    public String getTipo() {
        return "Tarjeta";
    }

    public String getTipoTarjeta() { return tipoTarjeta; }
    public void setTipoTarjeta(String tipoTarjeta) { this.tipoTarjeta = tipoTarjeta; }

    public String getNumeroTarjeta() { return numeroTarjeta; }
    public void setNumeroTarjeta(String numeroTarjeta) { this.numeroTarjeta = numeroTarjeta; }
}



// [src/main/java/com/hotel/hotel_backend/dto/NotaDeCreditoDTO.java]
// src/main/java/com/hotel/hotel_backend/dto/NotaDeCreditoDTO.java
package com.hotel.hotel_backend.dto;

import com.hotel.hotel_backend.dto.ResponsableDePago.ResponsableDePagoDTO;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

public class NotaDeCreditoDTO {

    private Integer idNota;
    private LocalDate fecha;
    private ResponsableDePagoDTO responsable;
    private List<FacturaDTO> facturas;
    private String tipo;

    // âœ… Constructor vacÃ­o para JSON/Jackson
    public NotaDeCreditoDTO() {
    }

    public NotaDeCreditoDTO(Integer idNota, LocalDate fecha,
                            ResponsableDePagoDTO responsable,
                            List<FacturaDTO> facturas,
                            String tipo) {
        this.idNota = idNota;
        this.fecha = fecha != null ? fecha : LocalDate.now();
        this.responsable = responsable;
        this.facturas = facturas != null ? facturas : new ArrayList<>();
        this.tipo = tipo;
    }

    public Integer getIdNota() { return idNota; }
    public void setIdNota(Integer idNota) { this.idNota = idNota; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public ResponsableDePagoDTO getResponsable() { return responsable; }
    public void setResponsable(ResponsableDePagoDTO responsable) { this.responsable = responsable; }

    public List<FacturaDTO> getFacturas() { return facturas; }
    public void setFacturas(List<FacturaDTO> facturas) { this.facturas = facturas; }

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }
}



// [src/main/java/com/hotel/hotel_backend/dto/PagoDTO.java]
// [src/main/java/com/hotel/hotel_backend/dto/PagoDTO.java]
package com.hotel.hotel_backend.dto;

import com.hotel.hotel_backend.dto.MedioDePago.MedioDePagoDTO;
import java.time.LocalDate;
import java.time.LocalTime;

public class PagoDTO {

    private int id;
    private LocalDate fecha;
    private LocalTime hora;
    private double montoTotal;
    private MedioDePagoDTO medioDePago;

    public PagoDTO() {}

    public PagoDTO(int id, LocalDate fecha, LocalTime hora,
                   double montoTotal, MedioDePagoDTO medioDePago) {
        this.id = id;
        this.fecha = fecha;
        this.hora = hora;
        this.montoTotal = montoTotal;
        this.medioDePago = medioDePago;
    }

    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public LocalDate getFecha() { return fecha; }
    public void setFecha(LocalDate fecha) { this.fecha = fecha; }

    public LocalTime getHora() { return hora; }
    public void setHora(LocalTime hora) { this.hora = hora; }

    public double getMontoTotal() { return montoTotal; }
    public void setMontoTotal(double montoTotal) { this.montoTotal = montoTotal; }

    public MedioDePagoDTO getMedioDePago() { return medioDePago; }
    public void setMedioDePago(MedioDePagoDTO medioDePago) { this.medioDePago = medioDePago; }
}



// [src/main/java/com/hotel/hotel_backend/dto/PersonaDTO.java]
// [src/main/java/com/hotel/hotel_backend/dto/PersonaDTO.java]
package com.hotel.hotel_backend.dto;

public class PersonaDTO {

    private String nombre;
    private String apellido;
    private String telefono;

    public PersonaDTO() {}

    public PersonaDTO(String nombre, String apellido, String telefono) {
        this.nombre = nombre;
        this.apellido = apellido;
        this.telefono = telefono;
    }

    public String getNombre() { return nombre; }
    public void setNombre(String nombre) { this.nombre = nombre; }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getTelefono() { return telefono; }
    public void setTelefono(String telefono) { this.telefono = telefono; }
}



// [src/main/java/com/hotel/hotel_backend/dto/ReservaDTO.java]
// [src/main/java/com/hotel/hotel_backend/dto/ReservaDTO.java]
package com.hotel.hotel_backend.dto;

import java.util.List;

public class ReservaDTO {

    private Integer id;
    private String fechaInicio;
    private String fechaFin;

    private PersonaDTO titular;     // ANTES: personaDTO

    private List<HabitacionDTO> habitaciones;

    private String estado;

    public ReservaDTO() {}

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public String getFechaInicio() { return fechaInicio; }
    public void setFechaInicio(String fechaInicio) { this.fechaInicio = fechaInicio; }

    public String getFechaFin() { return fechaFin; }
    public void setFechaFin(String fechaFin) { this.fechaFin = fechaFin; }

    public PersonaDTO getTitular() { return titular; }
    public void setTitular(PersonaDTO titular) { this.titular = titular; }

    public List<HabitacionDTO> getHabitaciones() { return habitaciones; }
    public void setHabitaciones(List<HabitacionDTO> habitaciones) {
        this.habitaciones = habitaciones;
    }

    public String getEstado() { return estado; }
    public void setEstado(String estado) { this.estado = estado; }
}



// [src/main/java/com/hotel/hotel_backend/dto/ResponsableDePago/ResponsableDePagoDTO.java]
package com.hotel.hotel_backend.dto.ResponsableDePago;

import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;

@JsonTypeInfo(
        use = JsonTypeInfo.Id.NAME,
        include = JsonTypeInfo.As.PROPERTY,
        property = "tipo"
)
@JsonSubTypes({
        @JsonSubTypes.Type(value = ResponsableHuespedDTO.class, name = "huesped"),
        @JsonSubTypes.Type(value = ResponsableJuridicoDTO.class, name = "juridica")
})
public abstract class ResponsableDePagoDTO {
    private String tipo; // "huesped" o "juridica"

    public String getTipo() { return tipo; }
    public void setTipo(String tipo) { this.tipo = tipo; }
}



// [src/main/java/com/hotel/hotel_backend/dto/ResponsableDePago/ResponsableHuespedDTO.java]
package com.hotel.hotel_backend.dto.ResponsableDePago;

public class ResponsableHuespedDTO extends ResponsableDePagoDTO {

    private String apellido;
    private String nombres;
    private String documento;

    public ResponsableHuespedDTO() {
        setTipo("huesped");
    }

    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }

    public String getNombres() { return nombres; }
    public void setNombres(String nombres) { this.nombres = nombres; }

    public String getDocumento() { return documento; }
    public void setDocumento(String documento) { this.documento = documento; }

}



// [src/main/java/com/hotel/hotel_backend/dto/ResponsableDePago/ResponsableJuridicoDTO.java]
package com.hotel.hotel_backend.dto.ResponsableDePago;

public class ResponsableJuridicoDTO extends ResponsableDePagoDTO {

    private String razonSocial;
    private String cuit;

    public ResponsableJuridicoDTO() {
        setTipo("juridica");
    }

    public String getRazonSocial() { return razonSocial; }
    public void setRazonSocial(String razonSocial) { this.razonSocial = razonSocial; }

    public String getCuit() { return cuit; }
    public void setCuit(String cuit) { this.cuit = cuit; }
}



// [src/main/java/com/hotel/hotel_backend/dto/UsuarioDTO.java]
package com.hotel.hotel_backend.dto;

public class UsuarioDTO {

    private Integer id;
    private String username;
    private String password;
    private String rol;

    public UsuarioDTO() {}

    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public String getRol() { return rol; }
    public void setRol(String rol) { this.rol = rol; }
}



// [src/main/java/com/hotel/hotel_backend/HotelBackendApplication.java]
package com.hotel.hotel_backend;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;


@SpringBootApplication
public class HotelBackendApplication {
    public static void main(String[] args) {
        SpringApplication.run(HotelBackendApplication.class, args);
    }
}



// [src/main/java/com/hotel/hotel_backend/service/EstadiaService.java]
// [src/main/java/com/hotel/hotel_backend/service/EstadiaService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.EstadiaDAO;
import com.hotel.hotel_backend.dao.ReservaDAO;
import com.hotel.hotel_backend.dao.HuespedDAO;
import com.hotel.hotel_backend.dao.HabitacionDAO;

import com.hotel.hotel_backend.domain.Estadia;
import com.hotel.hotel_backend.domain.Habitacion;
import com.hotel.hotel_backend.domain.Huesped;
import com.hotel.hotel_backend.domain.Reserva;

import com.hotel.hotel_backend.dto.EstadiaDTO;
import com.hotel.hotel_backend.dto.HuespedDTO;
import com.hotel.hotel_backend.service.Mapeo.MapearADTO;

import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.ArrayList;
import java.util.List;

@Service
public class EstadiaService {

    private final EstadiaDAO estadiaDAO;
    private final ReservaDAO reservaDAO;
    private final HabitacionDAO habitacionDAO;
    private final HuespedDAO huespedDAO;

    public EstadiaService(
            EstadiaDAO estadiaDAO,
            ReservaDAO reservaDAO,
            HabitacionDAO habitacionDAO,
            HuespedDAO huespedDAO
    ) {
        this.estadiaDAO = estadiaDAO;
        this.reservaDAO = reservaDAO;
        this.habitacionDAO = habitacionDAO;
        this.huespedDAO = huespedDAO;
    }

    // ==========================================================
    //                        GENERAR ESTADÃA (CHECK-IN)
    // ==========================================================
    public String generarEstadia(EstadiaDTO dto) {

        if (dto == null || dto.getReserva() == null || dto.getReserva().getId() == null)
            throw new RuntimeException("Debe enviar una reserva vÃ¡lida para generar la estadÃ­a.");

        Reserva reserva = reservaDAO.findById(dto.getReserva().getId())
                .orElseThrow(() -> new RuntimeException(
                        "No existe la reserva con ID " + dto.getReserva().getId()
                ));

        // Validar habitaciones: deben estar Reservadas
        for (Habitacion h : reserva.getHabitaciones()) {
            if (!h.getEstado().equalsIgnoreCase("Reservada")) {
                throw new RuntimeException(
                        "La habitaciÃ³n " + h.getNumero() + " no estÃ¡ reservada para esta estadÃ­a."
                );
            }
        }

        // Validar titular
        if (dto.getTitular() == null || dto.getTitular().getNumeroDocumento() == null)
            throw new RuntimeException("Debe enviar el titular con nÃºmero de documento.");

        Huesped titular = huespedDAO.findByNumeroDocumento(dto.getTitular().getNumeroDocumento())
                .orElseThrow(() -> new RuntimeException(
                        "No existe huÃ©sped con documento " + dto.getTitular().getNumeroDocumento()
                ));

        // AcompaÃ±antes
        List<Huesped> acompaniantes = new ArrayList<>();
        if (dto.getAcompaniantes() != null) {
            for (HuespedDTO hDto : dto.getAcompaniantes()) {
                Huesped h = huespedDAO.findByNumeroDocumento(hDto.getNumeroDocumento())
                        .orElseThrow(() -> new RuntimeException(
                                "No existe acompaÃ±ante con documento " + hDto.getNumeroDocumento()
                        ));
                acompaniantes.add(h);
            }
        }

        // Cambiar estado reserva â†’ Confirmada
        reserva.setEstado("Confirmada");
        reservaDAO.save(reserva);

        // Cambiar estado habitaciones â†’ Ocupada
        for (Habitacion hab : reserva.getHabitaciones()) {
            hab.setEstado("Ocupada");
            habitacionDAO.save(hab);
        }

        // Crear EstadÃ­a
        Estadia estadia = new Estadia();
        estadia.setId(dto.getId()); // puede venir null
        estadia.setFechaCheckIn(LocalDate.now());
        estadia.setHoraCheckIn(LocalTime.now());
        estadia.setFechaCheckOut(null);
        estadia.setHoraCheckOut(null);
        estadia.setEstado("EnCurso");

        estadia.setReserva(reserva);
        estadia.setTitular(titular);
        estadia.setAcompaniantes(acompaniantes);

        estadiaDAO.save(estadia);

        return "EstadÃ­a generada correctamente.";
    }

    // ==========================================================
    //              OBTENER ESTADÃA ACTIVA POR HABITACIÃ“N
    // ==========================================================
    public EstadiaDTO obtenerEstadiaActivaPorHabitacion(int numeroHabitacion) {

        Estadia estadia = estadiaDAO.findActivaByHabitacion(numeroHabitacion)
                .orElseThrow(() -> new RuntimeException(
                        "La habitaciÃ³n " + numeroHabitacion + " no tiene estadÃ­a activa."
                ));

        return MapearADTO.mapearEstadia(estadia);
    }

    // ==========================================================
    //                        CHECK-OUT
    // ==========================================================
    public EstadiaDTO registrarCheckOut(Integer idEstadia) {

        Estadia estadia = estadiaDAO.findById(idEstadia)
                .orElseThrow(() ->
                        new RuntimeException("No existe la estadÃ­a con ID " + idEstadia)
                );

        if (!"EnCurso".equalsIgnoreCase(estadia.getEstado())) {
            throw new RuntimeException("La estadÃ­a ya estÃ¡ finalizada.");
        }

        estadia.setFechaCheckOut(LocalDate.now());
        estadia.setHoraCheckOut(LocalTime.now());
        estadia.setEstado("Finalizada");

        // Volver habitaciones a disponible
        for (Habitacion h : estadia.getReserva().getHabitaciones()) {
            h.setEstado("Disponible");
            habitacionDAO.save(h);
        }

        estadiaDAO.save(estadia);

        return MapearADTO.mapearEstadia(estadia);
    }
}



// [src/main/java/com/hotel/hotel_backend/service/FacturaService.java]
// src/main/java/com/hotel/hotel_backend/service/FacturaService.java
package com.hotel.hotel_backend.service;

import java.time.LocalDate;
import java.util.List;

import com.hotel.hotel_backend.dao.FacturaDAO;
import com.hotel.hotel_backend.dao.NotaDeCreditoDAO;
import com.hotel.hotel_backend.dao.EstadiaDAO;

import com.hotel.hotel_backend.domain.Factura;
import com.hotel.hotel_backend.domain.NotaDeCredito;
import com.hotel.hotel_backend.domain.Estadia;
import com.hotel.hotel_backend.domain.Pago;
import com.hotel.hotel_backend.domain.ResponsableDePago.ResponsableDePago;
import com.hotel.hotel_backend.domain.MedioDePago.MedioDePago;

import com.hotel.hotel_backend.dto.FacturaDTO;
import com.hotel.hotel_backend.dto.NotaDeCreditoDTO;
import com.hotel.hotel_backend.dto.PagoDTO;

import com.hotel.hotel_backend.service.Mapeo.MapearADTO;
import com.hotel.hotel_backend.service.Mapeo.MapearADominio;

import org.springframework.stereotype.Service;

import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;

@Service
public class FacturaService {

    private final FacturaDAO facturaDAO;
    private final NotaDeCreditoDAO notaDAO;
    private final EstadiaDAO estadiaDAO;

    @PersistenceContext
    private EntityManager em;

    public FacturaService(FacturaDAO facturaDAO,
                          NotaDeCreditoDAO notaDAO,
                          EstadiaDAO estadiaDAO) {

        this.facturaDAO = facturaDAO;
        this.notaDAO = notaDAO;
        this.estadiaDAO = estadiaDAO;
    }

    // ==================================================
    //                CREAR FACTURA
    // ==================================================
    public FacturaDTO generarFactura(FacturaDTO dto) {

        if (dto == null)
            throw new RuntimeException("La factura no puede ser nula.");

        if (dto.getEstadia() == null || dto.getEstadia().getId() == null)
            throw new RuntimeException("Debe enviar ID de la estadÃ­a.");

        Estadia estadia = estadiaDAO.findById(dto.getEstadia().getId())
                .orElseThrow(() -> new RuntimeException(
                        "No existe la estadÃ­a con ID " + dto.getEstadia().getId()
                ));

        // Opcional pero recomendable: solo facturar estadÃ­as finalizadas
        if (!"Finalizada".equalsIgnoreCase(estadia.getEstado())) {
            throw new RuntimeException("Solo se puede facturar una estadÃ­a finalizada.");
        }

        // Mapeo base
        Factura factura = MapearADominio.mapearFactura(dto);

        // RESPONSABLE
        if (dto.getResponsableDePago() != null) {
            ResponsableDePago responsable = MapearADominio.mapearResponsableDePago(dto.getResponsableDePago());
            em.persist(responsable);
            factura.setResponsableDePago(responsable);
        }

        // MEDIO
        if (dto.getMedioDePago() != null) {
            MedioDePago medio = MapearADominio.mapearMedioDePago(dto.getMedioDePago());
            em.persist(medio);
            factura.setMedioDePago(medio);
        }

        // PAGOS (si vienen)
        if (dto.getPagos() != null && !dto.getPagos().isEmpty()) {
            List<Pago> pagos = dto.getPagos().stream()
                    .map(MapearADominio::mapearPago)
                    .toList();

            pagos.forEach(p -> p.setFactura(factura));
            factura.setPagos(pagos);
        }

        factura.setEstadia(estadia);
        facturaDAO.save(factura);

        return MapearADTO.mapearFactura(factura);
    }

    // ==================================================
    //              ACTUALIZAR FACTURA
    // ==================================================
    public FacturaDTO actualizarFactura(FacturaDTO dto) {

        if (dto == null)
            throw new RuntimeException("La factura no puede ser nula.");

        if (dto.getId() == 0)
            throw new RuntimeException("Debe enviar ID de la factura.");

        Factura original = facturaDAO.findById(dto.getId())
                .orElseThrow(() -> new RuntimeException(
                        "No existe la factura con ID " + dto.getId()
                ));

        if (!original.getEstado().equalsIgnoreCase("Pendiente")) {
            throw new RuntimeException("Solo se pueden modificar facturas pendientes.");
        }

        // 1) Actualizar campos primitivos
        original.setHora(dto.getHora());
        original.setFecha(dto.getFecha());
        original.setTipo(dto.getTipo());
        original.setEstado(dto.getEstado());
        original.setTotal(dto.getTotal());
        original.setIva(dto.getIva());
        original.setDetalle(dto.getDetalle());
        original.setHoraSalida(dto.getHoraSalida());

        // 2) Responsable
        if (dto.getResponsableDePago() != null) {
            ResponsableDePago resp = MapearADominio.mapearResponsableDePago(dto.getResponsableDePago());
            em.persist(resp);
            original.setResponsableDePago(resp);
        }

        // 3) Medio de Pago
        if (dto.getMedioDePago() != null) {
            MedioDePago medio = MapearADominio.mapearMedioDePago(dto.getMedioDePago());
            em.persist(medio);
            original.setMedioDePago(medio);
        }

        // 4) Pagos
        if (dto.getPagos() != null) {
            List<Pago> pagos = dto.getPagos().stream()
                    .map(MapearADominio::mapearPago)
                    .toList();

            pagos.forEach(p -> p.setFactura(original));
            original.setPagos(pagos);
        }

        facturaDAO.save(original);

        return MapearADTO.mapearFactura(original);
    }

    // ==================================================
    //              OBTENER FACTURA POR ID
    // ==================================================
    public FacturaDTO obtenerFacturaPorId(int id) {

        Factura factura = facturaDAO.findById(id)
                .orElseThrow(() -> new RuntimeException("Factura no encontrada con ID " + id));

        return MapearADTO.mapearFactura(factura);
    }

    // ==================================================
    //                LISTAR TODAS
    // ==================================================
    public List<FacturaDTO> listarTodas() {
        return facturaDAO.findAll().stream()
                .map(MapearADTO::mapearFactura)
                .toList();
    }

    // ==================================================
    //       PENDIENTES POR HABITACIÃ“N
    // ==================================================
    public List<FacturaDTO> obtenerPendientesPorHabitacion(int numeroHabitacion) {
        return facturaDAO.findPendientesByHabitacion(numeroHabitacion)
                .stream()
                .map(MapearADTO::mapearFactura)
                .toList();
    }

    // ==================================================
    //                PAGOS ENTRE FECHAS
    // ==================================================
    public List<PagoDTO> buscarPagoesEntreFechas(LocalDate desde, LocalDate hasta) {

        return facturaDAO.findPagosEntreFechas(desde, hasta)
                .stream()
                .map(MapearADTO::mapearPago)
                .toList();
    }

    // ==================================================
    //                CHEQUES ENTRE FECHAS
    // ==================================================
    public List<PagoDTO> buscarChequesEntreFechas(LocalDate desde, LocalDate hasta) {

        return facturaDAO.findChequesEntreFechas(desde, hasta)
                .stream()
                .map(MapearADTO::mapearPago)
                .toList();
    }

    // ==================================================
    //             CREAR NOTA DE CRÃ‰DITO
    // ==================================================
    public NotaDeCreditoDTO crearNotaDeCredito(NotaDeCreditoDTO dto) {

        if (dto == null)
            throw new RuntimeException("La nota de crÃ©dito no puede ser nula.");

        NotaDeCredito nota = MapearADominio.mapearNotaDeCredito(dto);

        // Reemplazar facturas de referencia por facturas REALES
        List<Factura> reales = dto.getFacturas().stream()
                .map(f -> facturaDAO.findById(f.getId())
                        .orElseThrow(() ->
                                new RuntimeException("Factura no encontrada con ID " + f.getId())))
                .toList();

        // Asignar facturas reales a la nota
        nota.setFacturas(reales);

        // Marcar facturas como CANCELADAS
        for (Factura f : reales) {
            f.setEstado("Cancelada");
            facturaDAO.save(f);
        }

        // Guardar nota
        notaDAO.save(nota);

        return MapearADTO.mapearNotaDeCredito(nota);
    }
}



// [src/main/java/com/hotel/hotel_backend/service/HabitacionService.java]
// src/main/java/com/hotel/hotel_backend/service/HabitacionService.java
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.HabitacionDAO;
import com.hotel.hotel_backend.domain.Habitacion;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class HabitacionService {

    private final HabitacionDAO habitacionDAO;

    public HabitacionService(HabitacionDAO habitacionDAO) {
        this.habitacionDAO = habitacionDAO;
    }

    public List<Habitacion> obtenerTodas() {
        return habitacionDAO.findAll();
    }

    public Habitacion obtenerPorNumero(int numero) {
        return habitacionDAO.findByNumero(numero)
                .orElseThrow(() ->
                        new RuntimeException("No existe la habitaciÃ³n NÂº " + numero));
    }

    public void cambiarEstado(int numero, String nuevoEstado) {

        Habitacion h = obtenerPorNumero(numero);
        String actual = normalizar(h.getEstado());
        nuevoEstado = normalizar(nuevoEstado);

        validarTransicion(actual, nuevoEstado, numero);

        h.setEstado(nuevoEstado);
        habitacionDAO.save(h);
    }

    private void validarTransicion(String actual, String nuevo, int nro) {

        switch (actual) {

            case "disponible" -> {
                if (!(nuevo.equals("reservada") || nuevo.equals("fueradeservicio"))) {
                    throw new RuntimeException(
                            "TransiciÃ³n invÃ¡lida para habitaciÃ³n " + nro +
                                    ": Disponible â†’ solo Reservada o FueraDeServicio."
                    );
                }
            }

            case "reservada" -> {
                if (!(nuevo.equals("ocupada") || nuevo.equals("disponible"))) {
                    throw new RuntimeException(
                            "TransiciÃ³n invÃ¡lida para habitaciÃ³n " + nro +
                                    ": Reservada â†’ solo Ocupada (check-in) o Disponible (cancelar)."
                    );
                }
            }

            case "ocupada" -> {
                if (!nuevo.equals("disponible")) {
                    throw new RuntimeException(
                            "TransiciÃ³n invÃ¡lida para habitaciÃ³n " + nro +
                                    ": Ocupada â†’ solo Disponible (check-out)."
                    );
                }
            }

            case "fueradeservicio" -> {
                if (!nuevo.equals("disponible")) {
                    throw new RuntimeException(
                            "TransiciÃ³n invÃ¡lida para habitaciÃ³n " + nro +
                                    ": FueraDeServicio â†’ solo Disponible."
                    );
                }
            }

            default -> throw new RuntimeException("Estado desconocido: " + actual);
        }
    }

    private String normalizar(String estado) {
        if (estado == null) return "";
        return estado.trim().toLowerCase();
    }
}



// [src/main/java/com/hotel/hotel_backend/service/HuespedService.java]
// [src/main/java/com/hotel/hotel_backend/service/HuespedService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.HuespedDAO;
import com.hotel.hotel_backend.domain.Huesped;
import com.hotel.hotel_backend.dto.HuespedDTO;
import com.hotel.hotel_backend.service.Mapeo.MapearADominio;
import com.hotel.hotel_backend.service.Mapeo.MapearADTO;

import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class HuespedService {

    private final HuespedDAO huespedDAO;

    public HuespedService(HuespedDAO huespedDAO) {
        this.huespedDAO = huespedDAO;
    }

    // ==========================================================
    //                    CREAR HUESPED
    // ==========================================================
    public HuespedDTO crearHuesped(HuespedDTO dto) {

        Huesped h = MapearADominio.mapearHuesped(dto);

        // Validar documento duplicado
        if (huespedDAO.existsByNumeroDocumento(h.getNumeroDocumento())) {
            throw new RuntimeException("Ya existe un huÃ©sped con ese nÃºmero de documento.");
        }

        // Validar CUIT duplicado
        if (h.getCuit() != null && !h.getCuit().isEmpty()) {
            List<Huesped> coincidencias = huespedDAO.findAllByCuit(h.getCuit());

            if (!dto.isForzar() && !coincidencias.isEmpty()) {
                throw new RuntimeException("CUIT_DUPLICADO");
            }


        }

        huespedDAO.save(h);

        return MapearADTO.mapearHuesped(h);
    }


    // ==========================================================
    //                   MODIFICAR HUESPED
    // ==========================================================
    public HuespedDTO modificarHuesped(HuespedDTO dto) {

        if (dto.getNumeroDocumento() == null) {
            throw new RuntimeException("Debe enviar documento del huÃ©sped a modificar.");
        }

        Huesped existente = huespedDAO.findByNumeroDocumento(dto.getNumeroDocumento())
                .orElseThrow(() -> new RuntimeException("No existe un huÃ©sped con ese documento."));

        Huesped nuevosDatos = MapearADominio.mapearHuesped(dto);

        existente.setApellido(nuevosDatos.getApellido());
        existente.setNombre(nuevosDatos.getNombre());
        existente.setTipoDocumento(nuevosDatos.getTipoDocumento());
        existente.setCuit(nuevosDatos.getCuit());
        existente.setDireccion(nuevosDatos.getDireccion());
        existente.setEmail(nuevosDatos.getEmail());
        existente.setOcupacion(nuevosDatos.getOcupacion());
        existente.setNacionalidad(nuevosDatos.getNacionalidad());

        huespedDAO.save(existente);

        return MapearADTO.mapearHuesped(existente);
    }

    // ==========================================================
    //                   BUSCAR UNO
    // ==========================================================
    public HuespedDTO buscarPorDocumento(String documento) {
        Huesped h = huespedDAO.findByNumeroDocumento(documento)
                .orElseThrow(() ->
                        new RuntimeException("No existe un huÃ©sped con ese documento."));
        return MapearADTO.mapearHuesped(h);
    }

    // ==========================================================
    //                 BUSCAR CON FILTROS
    // ==========================================================
    public List<HuespedDTO> buscarConFiltros(String apellido, String nombre,
                                             String tipoDocumento, String numeroDocumento) {

        return huespedDAO.buscarConFiltros(apellido, nombre, tipoDocumento, numeroDocumento)
                .stream()
                .map(MapearADTO::mapearHuesped)
                .toList();
    }

    // ==========================================================
    //                   LISTAR TODOS
    // ==========================================================
    public List<HuespedDTO> listarTodos() {
        return huespedDAO.findAll()
                .stream()
                .map(MapearADTO::mapearHuesped)
                .toList();
    }

    // ==========================================================
    //                     ELIMINAR
    // ==========================================================
    public void eliminarHuesped(String documento) {
        Huesped h = huespedDAO.findByNumeroDocumento(documento)
                .orElseThrow(() ->
                        new RuntimeException("No existe un huÃ©sped con ese documento."));
        huespedDAO.delete(h);
    }
}



// [src/main/java/com/hotel/hotel_backend/service/Mapeo/MapearADominio.java]
package com.hotel.hotel_backend.service.Mapeo;

import com.hotel.hotel_backend.domain.*;
import com.hotel.hotel_backend.domain.MedioDePago.*;
import com.hotel.hotel_backend.domain.ResponsableDePago.*;

import com.hotel.hotel_backend.dto.*;
import com.hotel.hotel_backend.dto.MedioDePago.*;
import com.hotel.hotel_backend.dto.ResponsableDePago.*;

public class MapearADominio {

    // =====================================================
    //                    DIRECCIÃ“N
    // =====================================================
    public static Direccion mapearDireccion(DireccionDTO dto) {
        if (dto == null) return null;

        Direccion d = new Direccion();
        d.setCalle(dto.getCalle());
        d.setNumero(dto.getNumero());
        d.setDepartamento(dto.getDepartamento());
        d.setPiso(dto.getPiso());
        d.setCodigoPostal(dto.getCodigoPostal());
        d.setLocalidad(dto.getLocalidad());
        d.setProvincia(dto.getProvincia());
        d.setPais(dto.getPais());
        return d;
    }

    // =====================================================
    //                    HUESPED
    // =====================================================
    public static Huesped mapearHuesped(HuespedDTO dto) {

        if (dto == null) return null;

        Huesped h = new Huesped();

        h.setNumeroDocumento(dto.getNumeroDocumento());
        h.setApellido(dto.getApellido());
        h.setNombre(dto.getNombre());
        h.setTipoDocumento(dto.getTipoDocumento());
        h.setCuit(dto.getCuit());
        h.setEmail(dto.getEmail());
        h.setOcupacion(dto.getOcupacion());
        h.setNacionalidad(dto.getNacionalidad());

        // Direccion anidada
        if (dto.getDireccion() != null) {
            Direccion d = new Direccion();
            d.setCalle(dto.getDireccion().getCalle());
            d.setNumero(dto.getDireccion().getNumero());
            d.setDepartamento(dto.getDireccion().getDepartamento());
            d.setPiso(dto.getDireccion().getPiso());
            d.setCodigoPostal(dto.getDireccion().getCodigoPostal());
            d.setLocalidad(dto.getDireccion().getLocalidad());
            d.setProvincia(dto.getDireccion().getProvincia());
            d.setPais(dto.getDireccion().getPais());
            h.setDireccion(d);
        }

        return h;
    }


    // =====================================================
    //                    FACTURA
    // =====================================================
    public static Factura mapearFactura(FacturaDTO dto) {
        if (dto == null) return null;

        Factura f = new Factura();
        f.setId(dto.getId());
        f.setFecha(dto.getFecha());
        f.setHora(dto.getHora());
        f.setEstado(dto.getEstado());
        f.setTipo(dto.getTipo());
        f.setTotal(dto.getTotal());
        f.setIva(dto.getIva());
        f.setDetalle(dto.getDetalle());
        f.setHoraSalida(dto.getHoraSalida());
        return f;
    }

    // =====================================================
    //                      PAGO
    // =====================================================
    public static Pago mapearPago(PagoDTO dto) {
        if (dto == null) return null;

        Pago p = new Pago();
        p.setId(dto.getId());
        p.setFecha(dto.getFecha());
        p.setHora(dto.getHora());
        p.setMontoTotal(dto.getMontoTotal());  // EXISTE EN DTO
        p.setMedioDePago(mapearMedioDePago(dto.getMedioDePago()));

        return p;
    }

    // =====================================================
    //            RESPONSABLE DE PAGO (polimÃ³rfico)
    // =====================================================
    public static ResponsableDePago mapearResponsableDePago(ResponsableDePagoDTO dto) {
        if (dto == null) return null;

        if (dto instanceof ResponsableHuespedDTO rh) {
            ResponsableHuesped r = new ResponsableHuesped();
            r.setApellido(rh.getApellido());
            r.setNombres(rh.getNombres());
            r.setDocumento(rh.getDocumento());
            return r;
        }

        if (dto instanceof ResponsableJuridicoDTO rj) {
            ResponsableJuridico r = new ResponsableJuridico();
            r.setRazonSocial(rj.getRazonSocial());
            r.setCuit(rj.getCuit());
            return r;
        }

        throw new RuntimeException("Tipo de ResponsableDePagoDTO invÃ¡lido: " + dto.getClass());
    }

    // =====================================================
    //            MEDIO DE PAGO (polimÃ³rfico)
    // =====================================================
    public static MedioDePago mapearMedioDePago(MedioDePagoDTO dto) {
        if (dto == null) return null;

        // ---------- EFECTIVO ----------
        if (dto instanceof EfectivoDTO ef) {
            return new Efectivo(ef.getMonto());
        }

        // ---------- CHEQUE ----------
        if (dto instanceof ChequeDTO c) {
            return new Cheque(
                    c.getNumero(),
                    c.getMonto(),
                    c.getFechaVencimiento()
            );
        }

        // ---------- TARJETA ----------
        if (dto instanceof TarjetaDTO t) {
            return new Tarjeta(
                    t.getTipoTarjeta(),
                    t.getNumeroTarjeta(),
                    t.getMonto()
            );
        }

        // ---------- MONEDA EXTRANJERA ----------
        if (dto instanceof MonedaExtranjeraDTO m) {
            return new MonedaExtranjera(
                    m.getTipoMoneda(),
                    m.getMontoExtranjero(),
                    m.getCotizacion(),
                    m.getMonto()
            );
        }

        throw new RuntimeException("Tipo de MedioDePagoDTO invÃ¡lido: " + dto.getClass());
    }

    // =====================================================
    //                 NOTA DE CRÃ‰DITO
    // =====================================================
    public static NotaDeCredito mapearNotaDeCredito(NotaDeCreditoDTO dto) {
        if (dto == null) return null;

        NotaDeCredito nc = new NotaDeCredito();
        nc.setIdNota(dto.getIdNota());
        nc.setFecha(dto.getFecha());
        nc.setResponsable(mapearResponsableDePago(dto.getResponsable()));
        nc.setTipo(dto.getTipo());
        // La lista de facturas se reemplaza en FacturaService
        return nc;
    }
}



// [src/main/java/com/hotel/hotel_backend/service/Mapeo/MapearADTO.java]
// [src/main/java/com/hotel/hotel_backend/service/Mapeo/MapearADTO.java]
package com.hotel.hotel_backend.service.Mapeo;

import com.hotel.hotel_backend.domain.*;
import com.hotel.hotel_backend.domain.MedioDePago.*;
import com.hotel.hotel_backend.domain.ResponsableDePago.*;
import com.hotel.hotel_backend.dto.*;
import com.hotel.hotel_backend.dto.MedioDePago.*;
import com.hotel.hotel_backend.dto.ResponsableDePago.*;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

public class MapearADTO {

    // ==========================================================
    //                      DIRECCION
    // ==========================================================
    public static DireccionDTO mapearDireccion(Direccion direccion) {
        if (direccion == null) return null;
        return new DireccionDTO(
                direccion.getCalle(),
                direccion.getNumero(),
                direccion.getDepartamento(),
                direccion.getPiso(),
                direccion.getCodigoPostal(),
                direccion.getLocalidad(),
                direccion.getProvincia(),
                direccion.getPais()
        );
    }

    // ==========================================================
    //                      HUESPED
    // ==========================================================
    public static HuespedDTO mapearHuesped(Huesped h) {

    if (h == null) return null;

    HuespedDTO dto = new HuespedDTO();

    dto.setNumeroDocumento(h.getNumeroDocumento());
    dto.setApellido(h.getApellido());
    dto.setNombre(h.getNombre());
    dto.setTipoDocumento(h.getTipoDocumento());
    dto.setCuit(h.getCuit());
    dto.setEmail(h.getEmail());
    dto.setOcupacion(h.getOcupacion());
    dto.setNacionalidad(h.getNacionalidad());

    Direccion dir = h.getDireccion();
    if (dir != null) {
        DireccionDTO d = new DireccionDTO(
                dir.getCalle(),
                dir.getNumero(),
                dir.getDepartamento(),
                dir.getPiso(),
                dir.getCodigoPostal(),
                dir.getLocalidad(),
                dir.getProvincia(),
                dir.getPais()
        );
        dto.setDireccion(d);
    }

    return dto;
}


    // ==========================================================
    //                      PERSONA
    // ==========================================================
    public static PersonaDTO mapearpersona(Persona t) {
        if (t == null) return null;
        return new PersonaDTO(
                t.getNombre(),
                t.getApellido(),
                t.getTelefono()
        );
    }

    // ==========================================================
    //                      HABITACION
    // ==========================================================
    public static HabitacionDTO mapearHabitacion(Habitacion h) {
        if (h == null) return null;

        HabitacionDTO dto = new HabitacionDTO();
        dto.setNumero(h.getNumero());
        dto.setTipo(h.getTipo());
        dto.setCategoria(h.getCategoria());
        dto.setCostoPorNoche(h.getCostoPorNoche());
        dto.setEstado(h.getEstado());

        return dto;
    }

    // ==========================================================
    //               MEDIO DE PAGO â†’ DTO
    // ==========================================================
    public static MedioDePagoDTO mapearMedioDePago(MedioDePago m) {
        if (m == null) return null;

        if (m instanceof Tarjeta t)
            return new TarjetaDTO(t.getTipoTarjeta(), t.getNumeroTarjeta(), t.getMonto());

        if (m instanceof Cheque c)
            return new ChequeDTO(c.getNumero(), c.getMonto(), c.getFechaVencimiento());

        if (m instanceof MonedaExtranjera me)
            return new MonedaExtranjeraDTO(
                    me.getTipoMoneda(),
                    me.getMontoExtranjero(),
                    me.getCotizacion(),
                    me.getMonto()
            );

        if (m instanceof Efectivo e)
            return new EfectivoDTO(e.getMonto());

        throw new RuntimeException("Tipo de medio de pago desconocido: " + m.getClass());
    }

    // ==========================================================
    //           RESPONSABLE DE PAGO â†’ DTO
    // ==========================================================
    public static ResponsableDePagoDTO mapearResponsableDePago(ResponsableDePago r) {
        if (r == null) return null;

        if (r instanceof ResponsableHuesped h) {
            ResponsableHuespedDTO dto = new ResponsableHuespedDTO();
            dto.setApellido(h.getApellido());
            dto.setNombres(h.getNombres());
            dto.setDocumento(h.getDocumento());
            return dto;
        }

        if (r instanceof ResponsableJuridico j) {
            ResponsableJuridicoDTO dto = new ResponsableJuridicoDTO();
            dto.setRazonSocial(j.getRazonSocial());
            dto.setCuit(j.getCuit());
            return dto;
        }

        throw new RuntimeException("Tipo de responsable desconocido: " + r.getClass());
    }

    // ==========================================================
    //                      PAGO â†’ DTO
    // ==========================================================
    public static PagoDTO mapearPago(Pago p) {
        if (p == null) return null;

        return new PagoDTO(
                p.getId(),
                p.getFecha(),
                p.getHora(),
                p.getMontoTotal(),
                mapearMedioDePago(p.getMedioDePago())
        );
    }

    public static List<PagoDTO> mapearPagos(List<Pago> pagos) {
        if (pagos == null) return new ArrayList<>();
        return pagos.stream().map(MapearADTO::mapearPago).collect(Collectors.toList());
    }

    // ==========================================================
    //                    RESERVA â†’ DTO
    // ==========================================================
    public static ReservaDTO mapearReserva(Reserva r) {

        if (r == null) return null;

        ReservaDTO dto = new ReservaDTO();

        dto.setId(r.getId());
        dto.setFechaInicio(r.getFechaInicio() != null ? r.getFechaInicio().toString() : null);
        dto.setFechaFin(r.getFechaFin() != null ? r.getFechaFin().toString() : null);
        dto.setEstado(r.getEstado());

        // Titular
        if (r.getTitular() != null) {
            dto.setTitular(mapearpersona(r.getTitular()));
        }

        // Habitaciones
        if (r.getHabitaciones() != null) {
            dto.setHabitaciones(
                    r.getHabitaciones().stream()
                            .map(MapearADTO::mapearHabitacion)
                            .toList()
            );
        }

        return dto;
    }


    // ==========================================================
    //                    ESTADIA â†’ DTO
    // ==========================================================
    // src/main/java/com/hotel/hotel_backend/service/Mapeo/MapearADTO.java

public static EstadiaDTO mapearEstadia(Estadia e) {

    if (e == null) return null;

    EstadiaDTO dto = new EstadiaDTO();

    dto.setId(e.getId());

    dto.setFechaCheckIn(e.getFechaCheckIn() != null ? e.getFechaCheckIn().toString() : null);
    dto.setHoraCheckIn(e.getHoraCheckIn() != null ? e.getHoraCheckIn().toString() : null);

    dto.setFechaCheckOut(e.getFechaCheckOut() != null ? e.getFechaCheckOut().toString() : null);
    dto.setHoraCheckOut(e.getHoraCheckOut() != null ? e.getHoraCheckOut().toString() : null);

    dto.setEstado(e.getEstado());

    dto.setReserva(mapearReserva(e.getReserva()));

    if (e.getTitular() != null)
        dto.setTitular(mapearHuesped(e.getTitular()));

    if (e.getAcompaniantes() != null)
        dto.setAcompaniantes(
                e.getAcompaniantes().stream()
                        .map(MapearADTO::mapearHuesped)
                        .toList()
        );

    return dto;
}


    // ==========================================================
    //                    FACTURA â†’ DTO
    // ==========================================================
    public static FacturaDTO mapearFactura(Factura f) {
        if (f == null) return null;

        return new FacturaDTO(
                f.getId(),
                f.getHora(),
                f.getFecha(),
                f.getTipo(),
                f.getEstado(),
                mapearResponsableDePago(f.getResponsableDePago()),
                mapearMedioDePago(f.getMedioDePago()),
                mapearEstadia(f.getEstadia()),
                mapearPagos(f.getPagos()),
                f.getTotal(),
                f.getIva(),
                f.getDetalle(),
                f.getHoraSalida()
        );
    }

    // ==========================================================
    //                      FECHAS
    // ==========================================================
    public static String fechaToString(LocalDate fecha) {
        return fecha != null ? fecha.toString() : null;
    }

    // ==========================================================
    //                 NOTA DE CRÃ‰DITO â†’ DTO
    // ==========================================================
    public static NotaDeCreditoDTO mapearNotaDeCredito(NotaDeCredito dominio) {
        if (dominio == null) return null;

        return new NotaDeCreditoDTO(
                dominio.getIdNota(),
                dominio.getFecha(),
                mapearResponsableDePago(dominio.getResponsable()),
                dominio.getFacturas() != null
                        ? dominio.getFacturas().stream()
                            .map(MapearADTO::mapearFactura)
                            .collect(Collectors.toList())
                        : new ArrayList<>(),
                dominio.getTipo()
        );
    }
}



// [src/main/java/com/hotel/hotel_backend/service/ReservaService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.HabitacionDAO;
import com.hotel.hotel_backend.dao.ReservaDAO;
import com.hotel.hotel_backend.domain.Habitacion;
import com.hotel.hotel_backend.domain.Persona;
import com.hotel.hotel_backend.domain.Reserva;
import com.hotel.hotel_backend.dto.HabitacionDTO;
import com.hotel.hotel_backend.dto.ReservaDTO;
import com.hotel.hotel_backend.dto.PersonaDTO;
import com.hotel.hotel_backend.service.Mapeo.MapearADTO;

import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.util.List;

@Service
public class ReservaService {

    private final ReservaDAO reservaDAO;
    private final HabitacionDAO habitacionDAO;

    public ReservaService(ReservaDAO reservaDAO, HabitacionDAO habitacionDAO) {
        this.reservaDAO = reservaDAO;
        this.habitacionDAO = habitacionDAO;
    }

    // =========================================================
    // CREAR RESERVA
    // =========================================================
    public ReservaDTO reservarHabitacion(ReservaDTO dto) {

        if (dto == null)
            throw new RuntimeException("La reserva no puede estar vacÃ­a.");

        LocalDate inicio = parse(dto.getFechaInicio());
        LocalDate fin = parse(dto.getFechaFin());

        if (fin.isBefore(inicio))
            throw new RuntimeException("La fecha de fin no puede ser anterior a la de inicio.");

        PersonaDTO t = dto.getTitular();
        if (t == null)
            throw new RuntimeException("Debe enviar titular de la reserva.");

        Persona titular = new Persona(t.getNombre(), t.getApellido(), t.getTelefono());

        if (dto.getHabitaciones() == null || dto.getHabitaciones().isEmpty())
            throw new RuntimeException("Debe seleccionar al menos una habitaciÃ³n.");

        // buscar habitaciones
        List<Habitacion> habitacionesReales =
                dto.getHabitaciones().stream()
                        .map(HabitacionDTO::getNumero)
                        .map(n -> habitacionDAO.findByNumero(n)
                                .orElseThrow(() ->
                                        new RuntimeException("No existe la habitaciÃ³n NÂº " + n)))
                        .toList();

        // validar solapamiento
        for (Habitacion h : habitacionesReales) {
            if (reservaDAO.existeSolapamiento(h.getNumero(), inicio, fin)) {
                throw new RuntimeException("La habitaciÃ³n NÂº " + h.getNumero()
                        + " ya estÃ¡ reservada en ese rango de fechas.");
            }
        }

        Reserva r = new Reserva();
        r.setFechaInicio(inicio);
        r.setFechaFin(fin);
        r.setTitular(titular);
        r.setHabitaciones(habitacionesReales);

        // ============================
        //  NUEVO: estado inicial = PENDIENTE
        // ============================
        r.setEstado("Pendiente");

        reservaDAO.save(r);

        return MapearADTO.mapearReserva(r);
    }

    // =========================================================
    // LISTAR ENTRE FECHAS
    // =========================================================
    public List<ReservaDTO> listarReservasEntre(String inicio, String fin) {

        LocalDate f1 = parse(inicio);
        LocalDate f2 = parse(fin);

        if (f2.isBefore(f1))
            throw new RuntimeException("La fecha final no puede ser anterior al inicio.");

        return reservaDAO.buscarEntreFechas(f1, f2)
                .stream()
                .map(MapearADTO::mapearReserva)
                .toList();
    }

    // =========================================================
    // CANCELAR RESERVA
    // =========================================================
    public ReservaDTO cancelarReserva(ReservaDTO dto) {

        if (dto.getId() == null)
            throw new RuntimeException("Debe enviar el ID de la reserva.");

        Reserva reserva = reservaDAO.findById(dto.getId())
                .orElseThrow(() ->
                        new RuntimeException("No existe la reserva con id " + dto.getId()));

        if (reserva.getEstado().equalsIgnoreCase("Cancelada"))
            throw new RuntimeException("La reserva ya estÃ¡ cancelada.");

        reserva.setEstado("Cancelada");
        reservaDAO.save(reserva);

        return MapearADTO.mapearReserva(reserva);
    }

    // =========================================================
    // UTILIDADES
    // =========================================================
    private LocalDate parse(String s) {
        if (s == null || s.isEmpty())
            throw new RuntimeException("Fecha obligatoria.");
        return LocalDate.parse(s);
    }
}



// [src/main/java/com/hotel/hotel_backend/service/UsuarioService.java]
package com.hotel.hotel_backend.service;

import com.hotel.hotel_backend.dao.UsuarioDAO;
import com.hotel.hotel_backend.domain.Usuario;
import com.hotel.hotel_backend.dto.UsuarioDTO;
import org.springframework.stereotype.Service;

@Service
public class UsuarioService {

    private final UsuarioDAO usuarioDAO;

    public UsuarioService(UsuarioDAO usuarioDAO) {
        this.usuarioDAO = usuarioDAO;
    }

    // ============================================================
    //                  AUTENTICAR USUARIO (CU01)
    // ============================================================
    public UsuarioDTO autenticar(String username, String password) {

        Usuario usuario = usuarioDAO.findByUsername(username)
                .orElseThrow(() -> new RuntimeException("Usuario no encontrado."));

        if (!usuario.getPassword().equals(password)) {
            throw new RuntimeException("ContraseÃ±a incorrecta.");
        }

        UsuarioDTO dto = new UsuarioDTO();
        dto.setId(usuario.getId());
        dto.setUsername(usuario.getUsername());
        dto.setRol(usuario.getRol());
        dto.setPassword(null); // nunca devolver password

        return dto;
    }

    // ============================================================
    //                 CREAR USUARIO (opcional)
    // ============================================================
    public UsuarioDTO crearUsuario(UsuarioDTO dto) {

        Usuario u = new Usuario();
        u.setUsername(dto.getUsername());
        u.setPassword(dto.getPassword());
        u.setRol(dto.getRol());

        usuarioDAO.save(u);

        dto.setId(u.getId());
        dto.setPassword(null);

        return dto;
    }
}



// [src/test/java/com/hotel/hotel_backend/HotelBackendApplicationTests.java]
package com.hotel.hotel_backend;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class HotelBackendApplicationTests {

	@Test
	void contextLoads() {
	}

}



